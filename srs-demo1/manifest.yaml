apiVersion: v1

system:
  functions:    
  - name: zk-lb
    count: 1
    containers:
    - name: zk-lb
      image: sfm-blitz1-zk-haproxy:0.2
      ports:
      - containerPort: 2181
      resources:
        limits: { cpu: ".5", memory: "500Mi" }
        requests: { cpu: ".5", memory: "500Mi" }

  - name: scone-sam
    count: 1
    containers:
    - name: scone-sam
      image: scone-uber-sam:0.20
      ports:
      - containerPort: 8080
      - containerPort: 15372
#      livenessProbe:
#        httpGet:
#          path: /manage/health
#          port: 15372
#          httpHeaders:
#          - name: Host
#            value: localhost:15372
#        failureThreshold: 7000
      resources:
        limits: { cpu: ".5", memory: "500Mi" }
        requests: { cpu: ".5", memory: "500Mi" }

  - name: srs-rc
    count: 1
    containers:
    - name: srs-rc
      image: report-collector
      ports:
      - name: provider
        containerPort: 8080
      - name: consumer
        containerPort: 8081
      - name: provider-https
        containerPort: 8443
      - name: consumer-https
        containerPort: 8444
      resources:
        limits: { cpu: "2", memory: "10Gi" }
        requests: { cpu: "2", memory: "10Gi" }
      logs:
      - directory: /var/log/report-collector
    - name: redis
      image: rc-redis:3.0
      ports:
      - containerPort: 6379
      resources:
        limits: { cpu: "1", memory: "10Gi" }
        requests: { cpu: "1", memory: "10Gi" }
      logs:
      - directory: /var/log/redis
    - name: announce-bark
      image: rc-announce-bark:0.1
      resources:
        limits: { cpu: ".1", memory: "500Mi" }
    - name: announce-reports
      image: rc-announce-reports:0.1
      resources:
        limits: { cpu: ".1", memory: "500Mi" }
      
  loadbalancers:
  - lbname: srs-rclb
    function: srs-rc
    ports:
      - port: 8080
        targetport: 8080
      - port: 8081
        targetport: 8081
      - port: 8443
        targetport: 8443
      - port: 8444
        targetport: 8444
  - lbname: scone-sam-lb
    function: scone-sam
    ports:
      - port: 8080
        targetport: 8080
      - port: 15372
        targetport: 15372
  - lbname: srs-zklb
    function: zk-lb
    ports:
      - port: 2181
        targetport: 2181
