apiVersion: v1

system:
  functions:
  - name: report-collector
    count: 1
    containers:
    - name: report-collector
      image: schu/rc_pe10 # report collector image with 10 provider endpoints
      ports:
        - name: provider-api-port
          containerPort: 8080
        - name: consumer-api-port
          containerPort: 8081
        - name: provider-api-port-secure
          containerPort: 8443
        - name: consumer-api-port-secure
          containerPort: 8444
      resources:
        limits: { cpu: "20", memory: "40Gi" }
        requests: { cpu: "20", memory: "40Gi" }
      logs:
      - directory:  /var/log/report-collector
    - name: redis
      image: rc-redis:3.0
      ports:
      - containerPort: 6379
      resources:
        limits: { cpu: "1", memory: "10Gi" }
        requests: { cpu: "1", memory: "10Gi" }
      logs:
      - directory:  /var/log/redis

  - name: locust-master
    count: 1
    containers:
    - name: locust-master
      image: locust_tasks/distributed
      ports:
        - name: locust-master-web
          containerPort: 8089
        - name: locust-master-worker-1
          containerPort: 5557
        - name: locust-master-worker-2
          containerPort: 5558

  - name: locust-worker
    count: 5
    containers:
    - name: locust-worker
      image: locust_tasks/distributed
      resources:
        limits: { cpu: "1", memory: "2Gi" }
        requests: { cpu: "1", memory: "2Gi" }

  loadbalancers:
    - lbname: reportcollectorlb
      function: report-collector
      ports:
        - port: 8080
          targetport: 8080
        - port: 8081
          targetport: 8081
        - port: 8443
          targetport: 8443
        - port: 8444
          targetport: 8444

    - lbname: locustmasterlb
      function: locust-master
      ports:
        - port: 8089
          targetPort: 8089
          name: loc-master-web
        - port: 5557
          targetPort: 5557
          name: locust-master-worker-1
        - port: 5558
          targetPort: 5558
          name: locust-master-worker-2