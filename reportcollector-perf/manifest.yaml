apiVersion: v1

system:
  functions:
  # - name: report-collector
  #   count: 1
  #   containers:
  #   - name: report-collector
  #     image: schu_reportcollector_pe10 # report collector image with 10 provider endpoints
  #     ports:
  #       - name: provider
  #         containerPort: 8080
  #       - name: consumer
  #         containerPort: 8081
  #       - name: provider-https
  #         containerPort: 8443
  #       - name: consumer-https
  #         containerPort: 8444
  #     resources:
  #       limits: { cpu: "20", memory: "40Gi" }
  #       requests: { cpu: "20", memory: "40Gi" }
  #     logs:
  #     - directory:  /var/log/report-collector
  #   - name: redis
  #     image: rc-redis:3.0
  #     ports:
  #     - containerPort: 6379
  #     resources:
  #       limits: { cpu: "1", memory: "10Gi" }
  #       requests: { cpu: "1", memory: "10Gi" }
  #     logs:
  #     - directory:  /var/log/redis

  - name: locust-master
    count: 1
    containers:
    - name: locust-master
      image: locust:prd_health_target_dfw_dump2
      ports:
        - name: loc-master-ui
          containerPort: 8089
        - name: loc-master-w1
          containerPort: 5557
        - name: loc-master-w2
          containerPort: 5558

  - name: locust-worker
    count: 30
    containers:
    - name: locust-worker
      image: locust:prd_health_target_dfw_dump2
      resources:
        limits: { cpu: "1", memory: "2Gi" }
        requests: { cpu: "1", memory: "2Gi" }

  loadbalancers:
    # - lbname: reportcollectorlb
    #   function: report-collector
    #   ports:
    #     - port: 8080
    #       targetport: 8080
    #     - port: 8081
    #       targetport: 8081
    #     - port: 8443
    #       targetport: 8443
    #     - port: 8444
    #       targetport: 8444

    - lbname: locustmasterlb
      function: locust-master
      ports:
        - port: 8089
          targetPort: 8089
          name: loc-master-ui
        - port: 5557
          targetPort: 5557
          name: loc-master-w1
        - port: 5558
          targetPort: 5558
          name: loc-master-w2
