apiVersion: v1

system:
  functions:
    - name: deployerbot
      count: 1
      containers:
        - name: phaser
          image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/hpamukcu/deployerbot]
          env:
            - name: GO_PIPELINE_LABEL
              value: 1
            - name: NODE_NAME
                valueFrom:
                  fieldRef:
                    fieldPath: spec.nodeName
          command: ["/moe/deployerbot/phaser"]
          args:
            - "-gheTokenPath=/secrets/ghe_pat"
            - "-pgpkeypath=/gpgsecrets/moe-signing-key.asc"
          volumeMounts:
            - mountPath: /secrets
              name: deployerbot-ghe-pat
              readOnly: true
            - mountPath: /gpgsecrets
              name: moe-gpg-signing-key
              readOnly: true
          livenessProbe:
            exec:
              command: ["ls", "/"]
            failureThreshold: 3
            initialDelaySeconds: 5
            periodSeconds: 60
      volumes:
        - name: deployerbot-ghe-pat
          k4aSecret:
            secretName: speedometer-ghe-pat
        - name: moe-gpg-signing-key
          k4aSecret:
            secretName: moe-gpg-signing-key