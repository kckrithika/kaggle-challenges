apiVersion: v1
 
system:
  functions:
  - name: grpc-service
    count: 2
    containers:
    - name: grpc-service
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/jbratton/jbratton-grpc-service:0.0.2
      ports:
      - name: grpc-port
        containerPort: 7020
    - name: sherpa
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/jbratton/sherpa:joey-5
      args: ["-s", "grpc-service"]
      ports:
      - name: admin-port
        containerPort: 7080
      - name: in-port
        containerPort: 7012
      - name: out-port
        containerPort: 7011
      readinessProbe:
        exec:
          command:
            - "./is-ready.sh" 
          initialDelaySeconds: 5 
          periodSeconds: 5
      livenessProbe:
        exec:
          command:
            - "./is-alive.sh" 
          initialDelaySeconds: 10
          periodSeconds: 5
 
  loadbalancers:
  - lbname: grpc-service-lb
    function: grpc-service
    ports:
      - name: admin-port
        port: 7080
        targetport: 7080
      - name: in-port
        port: 7012
        targetport: 7012
