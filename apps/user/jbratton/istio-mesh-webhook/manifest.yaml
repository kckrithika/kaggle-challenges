apiVersion: v1

system:
  notifications:
    email:
    - jbratton@salesforce.com
  functions:
  - name: istio-mesh-webhook
    count: 1
    containers:
    - name: istio-mesh-webhook
      image: sfci/servicemesh/istio-mesh-webhook:f99279b337f0d1fc5839217dd94cc30c5e4862b5
      args:
      - server
      - --cert
      - /client-certs/client/certificates/client.pem
      - --key
      - /client-certs/client/keys/client-key.pem
      - --port
      - 10443
      env:
      - name: KUBERNETES_SERVICE_HOST
        value: shared0-samkubeapi1-1-prd.eng.sfdc.net
      - name: KUBERNETES_SERVICE_PORT
        value: 8000
      livenessProbe:
        exec:
          command:
          - /bin/true
        initialDelaySeconds: 20
        periodSeconds: 5
      readinessProbe:
        exec:
          command:
          - /bin/true
        initialDelaySeconds: 15
        periodSeconds: 5
      volumeMounts:
        - name: tls-client-cert
          mountPath: /client-certs

    volumes:
      - name: tls-client-cert
        maddogCert:
          type: client
