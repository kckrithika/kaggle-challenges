apiVersion: v1
system:
  functions:
  - name: sdp
    count: 2
    containers:
    - name: benjamin-sam-deployment-portal
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/benjamin.caldwell/sam-deployment-portal-v2:20180823_163359.5cb6ffe8.clean.bencald-ltm0
      command:
      - "/sam/sam-deployment-portal-v2"
      - --port=64123
      - --db-hostname=mysql.csc-sam.prd-sam.prd.slb.sfdc.net
      - --db-username=root
      - --db-password-file=/volumes/dbpass/benjamin_config_sdp.txt
      - --db-name=sam_kube_resource
      - "--web-banner-text=SAM Deployment Portal is currently in Beta. Please submit feedback here:"
      - --web-banner-link=https://docs.google.com/forms/d/e/1FAIpQLScvoEhUmQpYfT76s4ABH99HnTJjYmwXUMErqgAjWkcDWSgjVQ/viewform?usp=sf_link
      - --web-banner-link-text=docs.google.com/forms
      - --v=4
      - --alsologtostderr
      ports:
      - containerPort: 64123
      volumeMounts:
       - mountPath: /volumes/dbpass
         name: dbpass
         readOnly: true
      livenessProbe:
        httpGet:
          path: /healthz
          port: 64123
      readinessProbe:
        httpGet:
          path: /healthz
          port: 64123
      env:
      - name: DUMMY_VAR
        value: em
    volumes:
    - name: dbpass
      k4aSecret:
        secretName: dbpass
  loadbalancers:
  - lbname: sdp2
    function: sdp
    slbenabled: true
    ports:
      - port: 80
        targetport: 64123
        lbtype: tcp
