apiVersion: v1

system:
  notifications:
    email:
      - mayank.kumar@salesforce.com
  functions:
  - name: zk-func
    type: stateful-set
    count: 3
    containers:
    - name: zk-func-cont
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/mayank.kumar/k8szk:v3
      resources:
        requests:
          memory: "2Gi"
          cpu: "500m"
      ports:
      - containerPort: 2181
        name: client
      - containerPort: 2888
        name: server
      - containerPort: 3888
        name: leader-election
      env:
      - name : ZK_REPLICAS
        value: "3"
      - name : ZK_HEAP_SIZE
        value: "1G"
      - name : ZK_TICK_TIME
        value: "2000"
      - name : ZK_INIT_LIMIT
        value: "10"
      - name : ZK_SYNC_LIMIT
        value: "5"
      - name : ZK_MAX_CLIENT_CNXNS
        value: "60"
      - name: ZK_SNAP_RETAIN_COUNT
        value: "3"
      - name: ZK_PURGE_INTERVAL
        value: "0"
      - name: ZK_CLIENT_PORT
        value: "2181"
      - name: ZK_SERVER_PORT
        value: "2888"
      - name: ZK_ELECTION_PORT
        value: "3888"
      command:
      - sh
      - -c
      - zkGenConfig.sh && zkServer.sh start-foreground
      readinessProbe:
        exec:
          command:
          - "zkOk.sh"
        initialDelaySeconds: 10
        timeoutSeconds: 5
      livenessProbe:
        exec:
          command:
          - "zkOk.sh"
        initialDelaySeconds: 10
        timeoutSeconds: 5
      volumeMounts:
      - name: datadir
        mountPath: /var/lib/zookeeper
    lbname: zk-func-svc
    terminationGracePeriodSeconds: 33
    volumeClaimTemplates:
    - name: datadir
      storageClassName: mayank-hdd-pool
      storageSizeRequest: 10Gi
