apiVersion: v1

system:
    notifications:
      email:
        - akouthoofd@salesforce.com
    functions:
    - name: maiev-receiver-func
      count: 1
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: prd-maiev-receiver
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/akouthoofd/casp-maiev:latest
        ports:
        - name: receiver-grpc
          containerPort: 7442
          hostPort: 17444
        - name: receiver-http
          containerPort: 8086
        - name: receiver-https
          containerPort: 8443
        livenessProbe:
          exec:
            command:
            - /usr/bin/true
        env:
        - name: MASTER_GRPC_PORT
          value: "7442"
        - name: CANTOR_GRPC_TARGET
          value: "cantor.user-akouthoofd.prd-sam.prd.slb.sfdc.net:11983"
        - name: HTTP_PORT
          value: "8085"
        - name: BASE_PATH
          value: "/v1/*"
        - name: BRANCH
          value: "eng_production"
        - name: KAKFA_PROPERTIES
          value: "/home/sfdc-maiev/receiver/kafka-producer.properties"
        - name: NODENAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        volumeMounts:
        - mountPath: /home/sfdc-maiev/certs
          name: maievservercert
        - mountPath: /home/sfdc-maiev/certs/client
          name: maievclientcert
      volumes:
      - name: maievservercert
        maddogCert:
          type: server
          lbnames:
          - maiev-receiver
      - name: maievclientcert
        maddogCert:
          type: client
    loadbalancers:
    - lbname: maiev-receiver
      function: maiev-receiver-func
      slbEnabled: true
      ports:
        - port: 7442
          targetport: 7442
        - port: 80
          targetport: 8086
        - port: 443
          targetport: 8443
