apiVersion: v1

system:
  functions:
  -
    name: sme-synthetics-qa
    count: 4
    containers:
    -
      name: search-model-executor
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/m.krishnan/search-model-executor:synthetics-qa
      env:
      -
        name: GRPC_ANNOUNCED_NAME
        value: sme-synthetics-qa
      -
        name: SFDC_ENVIRONMENT
        value: sam
      ports:
      -
        name: service-port
        containerPort: 7020
      -
        name: admin-port
        containerPort: 15372
      resources:
        limits: { cpu: 4, memory: "10Gi" }
        requests: { cpu: 4, memory: "4Gi" }
      livenessProbe:
        exec:
          command: ["./runcheck.sh", "5"]
        initialDelaySeconds: 60
        timeoutSeconds: 10
      readinessProbe:
        exec:
          command: ["./runcheck.sh", "5"]
        initialDelaySeconds: 60
        timeoutSeconds: 10
        periodSeconds: 60
    -
      name: sherpa-b
      image: sfci/servicelibs/sherpa:2.0.24
      env:
      -
        name: SFDC_ENVIRONMENT
        value: sam
      resources:
        limits: { cpu: 1, memory: "1Gi" }
        requests: { cpu: 1, memory: "1Gi" }
      ports:
      -
        name: sherpa-b-in
        containerPort: 7012
      -
        name: sherpa-b-adm
        containerPort: 7080
      livenessProbe:
        exec:
          command: ["./bin/is-alive"]
        initialDelaySeconds: 120
        periodSeconds: 5
      readinessProbe:
        exec:
          command: ["./bin/is-ready"]
        initialDelaySeconds: 110
        periodSeconds: 5
  -
    name: sme-1
    count: 4
    containers:
    -
      name: search-model-executor
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/ssstestorganization/smt-search-model-executor:0.0-RC.4
      args:
      - --modelstore.repo.models=model_repository_root/models
      - --modelstore.repo.manifests=model_repository_root/datacenters/${KINGDOM}/sme-1
      env:
      -
        name: GRPC_ANNOUNCED_NAME
        value: sme-1
      -
        name: SFDC_ENVIRONMENT
        value: sam
      ports:
      -
        name: service-port
        containerPort: 7020
      -
        name: admin-port
        containerPort: 15372
      resources:
        limits: { cpu: 4, memory: "10Gi" }
        requests: { cpu: 4, memory: "4Gi" }
      livenessProbe:
        exec:
          command: ["./runcheck.sh", "5"]
        initialDelaySeconds: 60
        timeoutSeconds: 10
      readinessProbe:
        exec:
          command: ["./runcheck.sh", "5"]
        initialDelaySeconds: 60
        timeoutSeconds: 10
        periodSeconds: 60
    -
      name: sherpa-b
      image: sfci/servicelibs/sherpa:2.0.24
      env:
      -
        name: SFDC_ENVIRONMENT
        value: sam
      resources:
        limits: { cpu: 1, memory: "1Gi" }
        requests: { cpu: 1, memory: "1Gi" }
      ports:
      -
        name: sherpa-b-in
        containerPort: 7012
      -
        name: sherpa-b-adm
        containerPort: 7080
      livenessProbe:
        exec:
          command: ["./bin/is-alive"]
        initialDelaySeconds: 120
        periodSeconds: 5
      readinessProbe:
        exec:
          command: ["./bin/is-ready"]
        initialDelaySeconds: 110
        periodSeconds: 5
