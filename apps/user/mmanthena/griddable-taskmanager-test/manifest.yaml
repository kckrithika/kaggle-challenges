apiVersion: v1
system:
  functions:
  - name: acds-taskmanager
    count: 1
    containers:
    - name: acds-taskmanager
      image: ops0-artifactrepo2-0-prd.data.sfdc.net/mmanthena/griddable-taskmanager:v0.0.1
      command:
      - /bin/bash
      - -c
      - /acds/bin/start-acds.sh
    env:
      - name : UP_STRING
        value: "ACDS TaskManager Started. Blocking."
      - name : UP_STRING
        value: "yes"
      - name : ACDS_APISERVER_HOST
        value: 
      - name : ACDS_APISERVER_PORT
        value: 
      - name : ACDS_APISERVER_HTTPS
        value:
      - name : ACDS_APISERVER_ZKCONN
        value: "griddable-zk-lb:2181"
      - name : SERVICE_USER_EMAIL
        value:
#      - name : SERVICE_USER_PASSWORD
#        value:
#      - name : TOKEN_SECRET
#        value:
  functions: 
  - name: griddable-zk
    type: stateful-set
    count: 3
    containers:
    - name: griddable-zk-cont
      image: ops0-artifactrepo2-0-prd.data.sfdc.net/mmanthena/zookeeper:v0.0.1 
      resources:
        requests:
          memory: "2Gi"
          cpu: "500m"
      ports:
      - containerPort: 2181
        name: client
      - containerPort: 2888
        name: server
      - containerPort: 3888
        name: leader-election
      env:
      - name : ZK_REPLICAS
        value: "3"
      - name : ZK_HEAP_SIZE
        value: "1G"
      - name : ZK_TICK_TIME
        value: "2000"
      - name : ZK_INIT_LIMIT
        value: "10"
      - name : ZK_SYNC_LIMIT
        value: "5"
      - name : ZK_MAX_CLIENT_CNXNS
        value: "60"
      - name: ZK_SNAP_RETAIN_COUNT
        value: "3"
      - name: ZK_PURGE_INTERVAL
        value: "0"
      - name: ZK_CLIENT_PORT
        value: "2181"
      - name: ZK_SERVER_PORT
        value: "2888"
      - name: ZK_ELECTION_PORT
        value: "3888"
      command:
      - sh
      - -c
      - zkGenConfig.sh && zkServer.sh start-foreground
      readinessProbe:
        exec:
          command:
          - "zkOk.sh"
        initialDelaySeconds: 10
        timeoutSeconds: 5
      livenessProbe:
        exec:
          command:
          - "zkOk.sh"
        initialDelaySeconds: 10
        timeoutSeconds: 5
      volumeMounts:
      - name: datadir
        mountPath: /var/lib/zookeeper
    lbname: griddable-zk-lb
    terminationGracePeriodSeconds: 33
    volumeClaimTemplates:
    - name: datadir
      storageClassName: standard
      storageSizeRequest: 5Gi
