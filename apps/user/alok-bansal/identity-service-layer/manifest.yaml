apiVersion: v1
system:
  functions:
  - name: identity-service-layer
    count: 1
    containers:
    # NGINX Rev Proxy
    - name: nginx-rev-proxy
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/alok-bansal/alok-nginx:latest
      ports:
      - containerPort: 8085
      livenessProbe:
        httpGet:
          path: /health
          port: 8085
        initialDelaySeconds: 15
        timeoutSeconds: 10
        periodSeconds: 30
      volumeMounts:
      - mountPath: /var/cache/nginx/client_temp
        name: cache-volume
    # GID service
    - name: gid-service
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/alok-bansal/gid-service:latest
      env:
      - name: ca_service_host
        value: 10.233.180.195
      ports:
      - containerPort: 8082
      - containerPort: 15375
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15375
      volumeMounts:
      - name: cert
        mountPath: /certs
    # C2C service
    - name: c2c-service
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/gid/c2c-service:latest
      env:
      - name: c2c_common_gdotBasePath
        value: http://10.233.180.195/scim
      - name: GDOT_URL
        value: http://10.233.180.195/scim
      ports:
      - containerPort: 8080
      - containerPort: 15372
      livenessProbe:
        httpGet:
          path: /manage/info
          port: 15372
      volumeMounts:
      - name: cert
        mountPath: /certs
    # Volumes Needed  
    volumes:
    - name: cache-volume
      emptyDir: {}
    - name: cert
      maddogCert:
        type: client
# SLB
  loadbalancers:
  - lbname: identity-service-layer-lb
    function: identity-service-layer
    slbEnabled: true
    ports:
      - port: 9090 
        targetport: 8085