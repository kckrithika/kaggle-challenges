apiVersion: v1
system:
  functions:
  - name: identity-service-layer
    count: 1
    containers:
    - name: nginx-rev-proxy
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/alok-bansal/alok-nginx:latest
      ports:
      - containerPort: 8085
      livenessProbe:
        httpGet:
          path: /health
          port: 8085
        initialDelaySeconds: 15
        timeoutSeconds: 10
        periodSeconds: 30
      volumeMounts:
      - mountPath: /var/cache/nginx/client_temp
        name: cache-volume

    # GID service
    - name: gid-service
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/alok-bansal/gid-service:latest
      ports:
      - containerPort: 8082
      - containerPort: 15375
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15375
      volumeMounts:
      - name: cert
        mountPath: /certs
    volumes:
    - name: cache-volume
      emptyDir: {}
    - name: cert
      maddogCert:
        type: client

  loadbalancers:
  - lbname: identity-service-layer-lb
    function: identity-service-layer
    slbEnabled: true
    ports:
      - port: 9090 
        targetport: 8085