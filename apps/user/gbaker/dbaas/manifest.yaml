apiVersion: v1

system:
  notifications:
    email:
    - gbaker@salesforce.com

  functions:
  - name: dbaas
    type: stateful-set
    count: 1
    containers:
    - name: dbaas
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/sayonara/dbaas:beta-20171114

      env:
      - name: DK_SRVR_DIR
        value: /certs/server
      - name: DK_MON_DIR
        value: /tmp/dktool_repo/dbaas/client
      - name: DK_CA_DIR
        value: /tmp/dktool_repo/ca
      - name: ADMINDB_CLUSTERNAME
        value: sdblsdb2
      - name: ZK_CONNECT_STRING
        value: sayonara1a-mnds1-3-prd.eng.sfdc.net:2181,sayonara1a-mnds1-1-prd.eng.sfdc.net:2181,sayonara1a-mnds1-2-prd.eng.sfdc.net:2181

      volumeMounts:
      - mountPath: /certs
        name: certs

      ports:
      - containerPort: 8080

      resources:
        requests:
          memory: "4Gi"
          cpu: "1"
        limits:
          memory: "16Gi"
          cpu: "2"

      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        failureThreshold: 1000000
        initialDelaySeconds: 180
        periodSeconds: 10


    volumes:
    - name: certs
      maddogCert:
        type: server

    lbname: dbaas-headless-lb

  loadbalancers:
  - lbname: dbaaslb
    function: dbaas
    nodeExposed: true
    ports:
    - port: 48080
      targetport: 8080
  - lbname: dbaas-slb
    function: dbaas
    slbEnabled: true
    ports:
    - port: 8080
      targetport: 8080
