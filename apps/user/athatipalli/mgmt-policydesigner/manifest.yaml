apiVersion: v1
system:
  functions:
    - name: mgmt-policydesigner
      count: 1
      type: stateful-set
      containers:
        - name: mgmt-policydesigner
          image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/anudeept/mgmt-policydesigner:1.0
          livenessProbe:
            exec:
              command: ["curl", "http://127.0.0.1:8080/"]
            initialDelaySeconds: 60
            timeoutSeconds: 10
          ports:
          - containerPort: 8080
          resources:
            requests:
              cpu: 2
              memory: 3Gi
            limits:
              cpu: 3
              memory: 4Gi
          env:
            - name: SHELL
              value: "/bin/sh"
            - name: UP_STRING
              value: "Policydesigner Server Blocking."
            - name: SERVERPORT
              value: 5004
            - name: NODE_ENV
              value: "production"
            - name: POLICY_DESIGNER_DB_HOSTNAME
              value: guiapi-db-lb
            - name: POLICY_DESIGNER_DB_PORT
              value: 3306
            - name: LOGGING_JSON_STDOUT_LEVEL
              value: all
            - name: LOGGING_STDERR_LEVEL
              value: all
            - name: SECRETS_PATH
              value: /var/policy-server-secrets/
          volumeMounts:
            - mountPath: /var/policy-server-secrets/
              name: policy-server-secrets-vol
              readOnly: true
      volumes:
        - name: policy-server-secrets-vol
          k4aSecret:
            secretName: policy-server-secrets
      lbname: mgmt-policydesigner-stateful-lb
  loadbalancers:
  - lbname: mgmt-pd-lb
    function: mgmt-policydesigner
    ports:
      - port: 8080
        targetport: 8080
