apiVersion: v1

system:
  functions:
  - name: prod-debug
    count: 1

    containers:

      - name: prod-debug-service
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/jsanzgonzalez/prod-debug:prod-debug-2019-05-28-16-54-59
        livenessProbe:
          exec:
            command:
            - cat
            - /tmp/live
          initialDelaySeconds: 10
          periodSeconds: 5
        readinessProbe:
         exec:
          command:
          - cat
          - /tmp/ready
         initialDelaySeconds: 10
         periodSeconds: 5

      - name: envoy-sidecar
        image: sfci/servicelibs/sherpa-envoy:1.0.7
        livenessProbe:
          exec:
            command:
            - ./bin/is-alive
          initialDelaySeconds: 20
          periodSeconds: 5
        ports:
        - containerPort: 13065
        - containerPort: 13066
        - containerPort: 15373
        volumeMounts:
          - mountPath: /cyan-config
            name: envoy-config-volume
          - mountPath: /certs/cert-client
            name: tls-client-cert


      - name: envoy-sidecar-config
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/jsanzgonzalez/cyan-config:jsanzgonzalez-20190527-223713
        env: 
        - name: CONFIG_DIR
          value: /home/sfdc-sherpa/sherpa-envoy-config-volume
        livenessProbe:
          exec:
            command:
            - cat
            - /tmp/live
          initialDelaySeconds: 20
          periodSeconds: 5
        volumeMounts:
          - mountPath: /home/sfdc-sherpa/sherpa-envoy-config-volume
            name: envoy-config-volume

    # The volumes to mount for shipping logs to splunk
    # General rule is to use path that satisfies the pattern: /home/sfdc-*/logs/**/*.json
    
    volumes:
      - maddogCert:
          type: client
        name: tls-client-cert
      - emptyDir: {}
        name: envoy-config-volume
