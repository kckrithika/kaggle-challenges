# created by scone-gen 3bd9a4697
apiVersion: v1

system:
  functions:
  - name: prod-debug
    count: 1

    containers:

      - name: prod-debug-service
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/jsanzgonzalez/prod-debug:jsanzgonzalez-20190523-1ff40bf
        ports:
        - containerPort: 15372
          name: scone-mgmt
        livenessProbe:
          initialDelaySeconds: 30
          httpGet:
            path: /manage/health
            port: 15372
        readinessProbe:
          timeoutSeconds: 10
          httpGet:
            path: /manage/ready
            port: 15372

      - name: envoy-sidecar
        image: sfci/servicelibs/sherpa-envoy:1.0.7
        livenessProbe:
          exec:
            command:
            - ./bin/is-alive
          initialDelaySeconds: 20
          periodSeconds: 5
        ports:
        - containerPort: 13065
        - containerPort: 13066
        - containerPort: 15373
        volumeMounts:
          - mountPath: /cyan-config
            name: envoy-config-volume
          - mountPath: /certs/cert-client
            name: tls-client-cert


      - name: envoy-sidecar-config
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/casam/cyan-config:49d21a
        env: 
        - name: CONFIG_DIR
          value: /home/sfdc-sherpa/sherpa-envoy-config-volume
        livenessProbe:
          exec:
            command:
            - cat
            - /tmp/live
          initialDelaySeconds: 3600
          periodSeconds: 5
        volumeMounts:
          - mountPath: /home/sfdc-sherpa/sherpa-envoy-config-volume
            name: envoy-config-volume

    # The volumes to mount for shipping logs to splunk
    # General rule is to use path that satisfies the pattern: /home/sfdc-*/logs/**/*.json
    
    volumes:
      - maddogCert:
          type: client
        name: tls-client-cert
      - emptyDir: {}
        name: envoy-config-volume
