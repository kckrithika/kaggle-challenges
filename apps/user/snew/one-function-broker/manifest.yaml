apiVersion: v1
system:
  functions:
  - name: one-function-broker
    count: 3
    containers:
    - name: basic-broker
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/snew/post-broke:1
      ports:
      - containerPort: 9292
      livenessProbe:
        httpGet:
          path: /
          port: 9292
        failureThreshold: 3
        initialDelaySeconds: 5
        periodSeconds: 60
      env:
        - name: PACT_BROKER_DATABASE_USERNAME
          value: postgres
        - name: PACT_BROKER_DATABASE_PASSWORD
          value: password
        - name: PACT_BROKER_DATABASE_HOST
          value: postgres
        - name: PACT_BROKER_DATABASE_NAME
          value: postgres

    - name: postgres
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/mgrass/postgres:9.3-sfdc
      ports:
      - containerPort: 5432
      livenessProbe:
        httpGet:
          path: /
          port: 5432
        failureThreshold: 3
        initialDelaySeconds: 5
        periodSeconds: 60
      env:
        - name: POSTGRES_USER
          value: postgres
        - name: POSTGRES_PASSWORD
          value: password
        - name: POSTGRES_DB
          value: postgres

  loadbalancers:
  - lbname: onebrokerlb
    function: one-function-broker
    slbenabled: true
    ports:
      - port: 9292
        targetport: 9292
        lbtype: tcp
