apiVersion: v1

system:
  notifications:
    email:
      - stanfield.chu@salesforce.com
  functions:
  - name: redis-ha-master
    type: stateful-set
    lbname: redis-ha-lb
    hostnetwork: true
    count: 1
    volumes:
      - name: redisauthvol
        secret:
          secretName: csc-redis-auth-0
    containers:
    - name: redis-ha-master
      image: dva/csc-health-redis-auth:jenkins-csc-health-redis-auth-PR-14-2-itest
      volumeMounts:
      - mountPath: /var/secrets/redis
        name: redisauthvol
        readOnly: true
      ports:
      - containerPort: 6379
      livenessProbe:
        tcpSocket:
          port: 6379
        initialDelaySeconds: 5
      command: ["/bin/sh", "-c"]
      args: ['
          ./configure_and_run_master.sh ;
          redis-server $REDIS_CONFIG_PATH
      ']
#  - name: redis-ha-slaves
#    type: stateful-set
#    hostnetwork: true
#    count: 2
#    volumes:
#      - name: redisauthvol
#        secret:
#          secretName: csc-redis-auth-0
#    containers:
#    - name: redis-ha-slave
#      image: dva/csc-health-redis-auth:jenkins-csc-health-redis-auth-PR-14-2-itest
#      volumeMounts:
#      - mountPath: /var/secrets/redis
#        name: redisauthvol
#        readOnly: true
#      ports:
#      - containerPort: 6379
#      livenessProbe:
#        tcpSocket:
#          port: 6379
#        initialDelaySeconds: 5
#      command: ["/bin/sh", "-c"]
#      args: ['
#          ./configure_and_run_slave.sh ;
#          redis-server $REDIS_CONFIG_PATH
#      ']