apiVersion: v1

system:
  notifications:
    email:
      - stanfield.chu@salesforce.com
  functions:
  - name: redis-ha
    count: 1
    volumes:
      - name: redisauthvol
        secret:
          secretName: csc-redis-auth-0
    containers:
    - name: redis-ha-master
      image: dva/csc-health-redis-auth:jenkins-csc-health-redis-auth-redis-ha-poc-1-itest
      volumeMounts:
      - mountPath: /var/secrets/redis
        name: redisauthvol
        readOnly: true
      ports:
      - containerPort: 6379
      livenessProbe:
        tcpSocket:
          port: 6379
        initialDelaySeconds: 5
      command: ["/bin/sh", "-c"]
      args: ['
          redis-server $REDIS_CONFIG_PATH
      ']

  loadbalancers:
  - lbname: stansreportcollectorlb
    function: stans-report-collector
    nodeExposed: true
    ports:
    - port: 28082
      targetport: 8082
    - port: 28443
      targetport: 8443
    - port: 28444
      targetport: 8444
  - lbname: redislb
    function: redis
    nodeExposed: true
    ports:
      - port: 26379
        targetport: 6379
