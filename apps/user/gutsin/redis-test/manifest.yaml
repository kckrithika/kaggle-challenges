apiVersion: v1
system:
  functions:
  - name: redis-master
    count: 1
    labels:
      sentinel: "true"
    containers:
    - name: sentinel
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:3.2.7b
      env:
        - name: SENTINEL
          value: "true"
        - name: BOOTSTRAP
          value: "true"
      ports:
        - containerPort: 26379
    - name: master
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:3.2.7b
      env:
        - name: MASTER
          value: "true"
      ports:
      - containerPort: 6379
      livenessProbe:
        exec:
          command:
          - redis-cli
          - ping
        initialDelaySeconds: 5
        periodSeconds: 5
      volumeMounts:
      - mountPath: /redis-master-data
        name: data
      workingDir: /redis-master-data
    volumes:
    - emptyDir: {}
      name: data
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 1
        maxUnavailable: 0

  - name: redis-rc
    count: 2
    labels:
      sentinel: "true"
    containers:
    - name: redis
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:3.2.7b
      ports:
      - containerPort: 6379
      volumeMounts:
      - mountPath: /redis-master-data
        name: data
      workingDir: /redis-master-data
    - name: sentinel
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:3.2.7b
      env:
        - name: SENTINEL
          value: "true"
      ports:
      - containerPort: 26379
    volumes:
    - emptyDir: {}
      name: data
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 1
        maxUnavailable: 0

  - name: redis-sentinel
    count: 2
    labels:
      sentinel: "true"
    containers:
    - name: sentinel
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:3.2.7b
      env:
        - name: SENTINEL
          value: "true"
      ports:
      - containerPort: 26379
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 1
        maxUnavailable: 0

  loadbalancers:
  - lbname: sentinel-lb
    selector:
      sentinel: "true"
    ports:
      - port: 26379
        targetport: 26379
