apiVersion: v1

system:
  functions:

  - name: redis-master
    count: 1
    containers:
    - name: sentinel
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:kube
      env:
        - name: SENTINEL
          value: "true"
      ports:
        - containerPort: 26379
    - name: redis-master
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:1
      env:
        - name: MASTER
          value: "true"
      ports:
      - containerPort: 6379
      volumeMounts:
      - mountPath: /redis-master-data
        name: data
    volumes:
    - emptyDir: {}
      name: data

  - name: redis-rc
    count: 3
    containers:
    - name: redis
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:1
      ports:
      - containerPort: 6379
      volumeMounts:
      - mountPath: /redis-master-data
        name: data
    volumes:
    - emptyDir: {}
      name: data

  - name: redis-sentinel
    count: 3
    containers:
    - name: sentinel
      image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-redis:1
      env:
        - name: SENTINEL
          value: "true"
      ports:
      - containerPort: 26379

  loadbalancers:
  - lbname: sentinel-lb
    function: redis-sentinel
    ports:
      - port: 26379
        targetport: 26379
