apiVersion: v1
system:
  functions:
  - name: mongo-rs
    count: 3
    containers:
      - name: mongo
        image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-mongo:1
        command:
          - mongod
          - "--replSet"
          - rs0
          - "--smallfiles"
          - "--noprealloc"
          - "--dbpath"
          - /mongo-master-data
        ports:
          - containerPort: 27017
        volumeMounts:
        - mountPath: /mongo-master-data
          name: data
      - name: mongo-sidecar
        image: shared0-samcontrol1-1-prd.eng.sfdc.net:5000/gutsin-mongo:sidecar
        env:
          - name: MONGO_SIDECAR_POD_LABELS
            value: "role=mongo,environment=test"
    volumes:
    - emptyDir: {}
      name: data
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 0
        maxUnavailable: 1

  loadbalancers:
  - lbname: mongo-lb
    function: mongo-rs
    ports:
      - port: 27017
        targetport: 27017
