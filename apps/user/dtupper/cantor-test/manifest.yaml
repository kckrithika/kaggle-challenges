apiVersion: v1

system:
    notifications:
      email:
        - dtupper@salesforce.com
    functions:
    - name: dtcantor-test-func
      count: 1
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: dtcantor-test-1
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/dtupper/sfdc-cantor:test-0035
        ports:
        - name: cantor
          containerPort: 7443
        volumeMounts:
        - mountPath: /home/sfdc-cantor/cantor
          name: cantor-vol
        - mountPath: /home/sfdc-cantor/pki/server
          name: cantorservercert
        - mountPath: /home/sfdc-cantor/pki/client
          name: cantorclientcert
        env:
        - name: SHARD
          value: "1"
        livenessProbe:
          exec:
            command:
            - /usr/bin/true
      - name: dtcantor-test-2
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/dtupper/sfdc-cantor:test-0035
        ports:
        - name: cantor
          containerPort: 7444
        volumeMounts:
        - mountPath: /home/sfdc-cantor/cantor
          name: cantor-vol
        - mountPath: /home/sfdc-cantor/pki/server
          name: cantorservercert
        - mountPath: /home/sfdc-cantor/pki/client
          name: cantorclientcert
        env:
        - name: SHARD
          value: "2"
        livenessProbe:
          exec:
            command:
            - /usr/bin/true
      - name: dtcantor-test-3
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/dtupper/sfdc-cantor:test-0035
        ports:
        - name: cantor
          containerPort: 7445
        volumeMounts:
        - mountPath: /home/sfdc-cantor/cantor
          name: cantor-vol
        - mountPath: /home/sfdc-cantor/pki/server
          name: cantorservercert
        - mountPath: /home/sfdc-cantor/pki/client
          name: cantorclientcert
        env:
        - name: SHARD
          value: "3"
        livenessProbe:
          exec:
            command:
            - /usr/bin/true
      volumes:
      - name: cantor-vol
        hostPath:
          path: /data/cantor
      - name: cantorservercert
        maddogCert:
          type: server
          lbnames:
          - cantor
      - name: cantorclientcert
        maddogCert:
          type: client
    loadbalancers:
    - lbname: cantor
      function: dtcantor-test-func
      slbEnabled: true
      ports:
        - port: 7443
          targetport: 7443
        - port: 7444
          targetport: 7444
        - port: 7445
          targetport: 7445