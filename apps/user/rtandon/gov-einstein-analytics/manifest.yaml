apiVersion: v1

system:
  notifications:
    email:
      - govcloud-secdev@salesforce.com
  functions:
  - name: gov-einstein-analytics
    count: 1
    containers:
    - name: airstream
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/rtandon/airstream:0f94959ef252
      command: ["/airstream-app/entrypoint.sh"]
      args: ["test"]
      livenessProbe:
        initialDelaySeconds: 30
        exec:
          command:
            - /airstream-app/liveness_probe.sh
      env:
      - name: HTTP_PROXY
        value: public0-proxy1-0-prd.data.sfdc.net:8080
      - name: HTTPS_PROXY
        value: public0-proxy1-0-prd.data.sfdc.net:8080
      - name: WAVE_USER
        value: "rtandon.analytics@salesforce.com"
      - name: WAVE_ENV
        value: "na85"
      - name: WAVE_ACCOUNT_ID_DS
        value: "test_dataset"
      - name: HOST_NAME
        value: "rtandon-wsl.internal.salesforce.com"
      - name: PLSQL_FILE_PATH
        value: "/home/rtandon/Development/scripts/airstream-app/test_data.pls"
      - name: KRB5_KTNAME
        value: "/var/secrets/krb5_keytab/gov-analytics-test.keytab"
      - name: KRB5_CONFIG
        value: "/var/secrets/krb5_conf/krb5.conf"
      - name: KRB5CCNAME
        value: "FILE:/tmp/tgt"
      - name: CONFIG_FILE
        value: "/var/secrets/profile/user-profile.cfg"
      volumeMounts:
      - name: user-profile-test
        mountPath: /var/secrets/profile
        readOnly: true
      - name: krb-keytab-test
        mountPath: /var/secrets/krb5_keytab
        readOnly: true
      - name: krb-conf-test
        mountPath: /var/secrets/krb5_conf
        readOnly: true
      imagePullPolicy: Always
    volumes:
    - name: user-profile-test
      k4aSecret:
        secretName: gov-einstein-analytics-user-profile-secret-test
    - name: krb-keytab-test
      k4aSecret:
        secretName: gov-einstein-analytics-krb-keytab-secret-test
    - name: krb-conf-test
      k4aSecret:
        secretName: gov-einstein-analytics-krb-conf-secret-test
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 0
        maxUnavailable: 1