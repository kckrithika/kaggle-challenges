apiVersion: v1
system:
  functions:
  - name: default
    count: 2
    containers:
    - name: samsdbzookeeper
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/kj/zookeeper:version1
      ports:
      - containerPort: 2181
        name: client
      - containerPort: 2888
        name: server
      - containerPort: 3888
        name: leader-election
      env:
        - name : ZK_REPLICAS
          value: "3"
        - name : ZK_HEAP_SIZE
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: jvm.heap
        - name : ZK_TICK_TIME
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: tick
        - name : ZK_INIT_LIMIT
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: init
        - name : ZK_SYNC_LIMIT
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: tick
        - name : ZK_MAX_CLIENT_CNXNS
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: client.cnxns
        - name: ZK_SNAP_RETAIN_COUNT
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: snap.retain
        - name: ZK_PURGE_INTERVAL
          valueFrom:
            configMapKeyRef:
                name: zk-cm
                key: purge.interval
        - name: ZK_CLIENT_PORT
          value: "2181"
        - name: ZK_SERVER_PORT
          value: "2888"
        - name: ZK_ELECTION_PORT
          value: "3888"
      command:
        - sh
        - -c
        - zkGenConfig.sh && zkServer.sh start-foreground
      readinessProbe:
        exec:
         command:
          - "zkOk.sh"
        initialDelaySeconds: 10
        timeoutSeconds: 5
      livenessProbe:
        exec:
         command:
          - "zkOk.sh"
        initialDelaySeconds: 10
        timeoutSeconds: 5
