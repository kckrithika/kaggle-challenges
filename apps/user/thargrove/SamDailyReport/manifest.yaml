apiVersion: v1

system:
  functions:
  - name: samreport
    count: 1
#    hostnetwork: true
    containers:
    - name: samreport
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/thargrove/hypersam:20170330_155532.686497e.dirty.thargrove-ltm1
      command: ["/sam/sam-daily-report"]
      args: ["-tokenfile", "/var/secrets/git/token.txt", "-argususerfile", "/var/secrets/argus/argus-username", "-arguspasswordfile", "/var/secrets/argus/argus-password"]
      ports:
      - containerPort: 64122
      livenessProbe:
        httpGet:
          path: /probe
          port: 64122
      volumeMounts:
        - mountPath: /var/secrets/git
          name: gitvol
          readOnly: true
        - mountPath: /var/secrets/argus
          name: argusvol
          readOnly: true
    volumes:
    - name: argusvol
      secret:
        secretName: argus
    - name: gitvol
      secret:
        secretName: git-token
  loadbalancers:
  - lbname: samdrlb
    function: samreport
    nodeExposed: true
    ports:
      - port: 64122
        targetport: 64122
