apiVersion: v1
system:
  functions:
  - name: revpathproxytestone
    count: 1
    # Ports below should match those in the Nginx reverse path proxy's nginx.conf
    containers:
    - name: revpathproxy
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/ccotofana/nginx-revpathproxy:lh-20190515
      ports:
      - containerPort: 8085
      livenessProbe:
        httpGet:
          path: /health
          port: 8085
        initialDelaySeconds: 15
        timeoutSeconds: 5
        periodSeconds: 60
      volumeMounts:
      - mountPath: /var/cache/nginx/client_temp
        name: cache-volume

    # Fake GID service
    - name: appone
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/ccotofana/samhello:withargs
      command: ["/bin/samhello"]
      args: ["8080", "one"]
      ports:
      - containerPort: 8080
      livenessProbe:
        httpGet:
          path: /
          port: 8080

    # Fake Entity API
    - name: apptwo
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/ccotofana/samhello:withargs 
      command: ["/bin/samhello"]
      args: ["8082", "two"]
      ports:
      - containerPort: 8082
      livenessProbe:
        httpGet:
          path: /
          port: 8082

    volumes:
    - name: cache-volume
      emptyDir: {}

loadbalancers:
 - lbname: revpathproxytestonelb
   function: revpathproxytestone
   slbEnabled: true
   # Ports not mentioned here are still forwarded to target container
   ports:
      - port: 9090
        targetport: 8085
      - port: 8080
        targetport: 8080
      - port: 8082
        targetport: 8082

