apiVersion: v1
system:
  notifications:
    email:
      - moanaserviceseng@salesforce.com
  functions:
  - name: moana-driver
    identity:
      serviceName: moana-driver
    count: 1
    containers:
    - name: moana-driver
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/insights/moana-driver:master-22-aef3e04
      ports:
      - containerPort: 8080
        name: http
      - containerPort: 15372
        name: mgmt
      livenessProbe:
        initialDelaySeconds: 30
        periodSeconds: 60
        timeoutSeconds: 30
        httpGet:
          path: /manage/health
          port: 15372
      env:
      - name: SFDC_ENVIRONMENT
        value: kingdom-test

      - name: LOGGING_JSON_STDOUT_LEVEL
        value: all
      - name: LOGGING_STDERR_LEVEL
        value: ALL

      - name: PKI_TRUSTSTORE_DIR
        value: /home/scone/client-certs

      - name: PKI_KEYSTORE_DIR
        value: /home/scone/client-certs/client

      - name: JAVA_OPTS
        value: -server -XX:MaxMetaspaceSize=128m -Xmx512m -Xms512m

      volumeMounts:
      - mountPath: /home/scone/client-certs
        name: tls-client-certs

      resources:
        limits:
          cpu: 2
          memory: 1G
        requests:
          cpu: 1
          memory: 1G
    volumes:
    - name: tls-server-certs
      maddogCert:
        type: server

    - name: tls-client-certs
      maddogCert:
        type: client


  loadbalancers:
  - lbname: moana-driver-lb
    function: moana-driver
    nodeExposed: true
    slbEnabled: true
    ports:
    - lbtype: http
      port: 8126
      targetport: 15372
    - port: 8127
      targetport: 8080


