# Warning: DO NOT EDIT this generated file
# See here on how to generate this file https://git.soma.salesforce.com/casam/casamctl

apiVersion: v1
system:
  functions:
  - containers:
    - args:
      - |
        while [ ! -f '/home/sfdc/salesforce/casam/.overrides_sidecar_done' ]; do echo -ne 'Waiting for coverride sidecar to complete its job\n' ;  sleep 1 ; done ;
        export DB_PASSWORD=$(cat /home/sfdc/salesforce/config/settings/overrides/gcp-mvp-3az-db-pw/dbpw3az.txt) ;
        cp /home/sfdc/salesforce/casam/lib/metrics-publishing.jar.optional /home/sfdc/salesforce/casam/lib/metrics-publishing.jar ;
        mkdir -p /home/sfdc/salesforce/sfdc-test/func/mockk4avault ;
        unzip /home/sfdc/salesforce/casam/lib/k4a.zip.testkeys -d /home/sfdc/salesforce/sfdc-test/func/mockk4avault ;
        cp -fr /home/sfdc/salesforce/sfdc/config/keyrepo-goldfiles/dev/. /home/sfdc/salesforce/sfdc/config/keyrepo-goldfiles/prod ;
        /home/sfdc/salesforce/casam/bin/startup.sh
      command:
      - /bin/sh
      - -c
      env:
      - name: DB_SID
        value: NADB11
      - name: DB_INSTANCE_NAME
        value: NADB11-1
      - name: DB_USER
        value: sleepy
      - name: IP_DB
        value: 10.168.160.184
      - name: SERVER_ID
        value: 5
      - name: PUBLIC_PORT
        value: 443
      - name: PUBLIC_PORT_IS_SECURE
        value: true
      - name: PUBLIC_HOST_NAME
        value: casam.devmvp.gcp.sfdcsvc.net
      - name: SFPROXY_VIP
        value: https://casam.devmvp.gcp.sfdcsvc.net
      - name: HTTP_PORT
        value: 8085
      - name: SPORT
        value: 8443
      - name: S2PORT
        value: 12098
      - name: PLSQL_UPDATE_RUNSTATS
        value: false
      - name: DISABLE_AUTH_RELEASE_CHECK
        value: true
      - name: CASAM_APP_COLOR
        value: green
      - name: SD_PORT_OVERRIDE
        value: 13065
      - name: CASAM_SETTINGS_PATH
        value: prod.-.phx.na3.app
      - name: CLUSTER_NAME
        value: devmvp
      - name: DEPLOYMENT
        value: G
      - name: ZDT
        value: true
      - name: CASAM_HOST_NAME
        valueFrom:
          fieldRef:
            fieldPath: spec.nodeName
      - name: USE_CONFIG_SIDECAR
        value: 1
      - name: NONCE
        value: 1555695408380356864
      - name: REDEPLOY
        value: 1
      - name: INTERNAL_ENV
        value: true
      - name: GOOGLE_APPLICATION_CREDENTIALS
        value: /var/secrets/google/gsf-core-devmvp-sam2-dd7bedce4ba4.json
      - name: SU_USERNAME
        value: oentry@na3.salesforce.com
      - name: SU_ORGID
        value: 00D500000008aMD
      - name: SU_USERID
        value: 00550000000HgO1
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-devmvp/casam/coreapp:release_main_17983190
      livenessProbe:
        exec:
          command:
          - /home/sfdc/salesforce/casam/bin/live_probe.sh
        failureThreshold: 99999
        initialDelaySeconds: 120
        periodSeconds: 5
        timeoutSeconds: 5
      name: coreapp
      ports:
      - containerPort: 8998
      - containerPort: 8085
      - containerPort: 11211
      - containerPort: 12098
      - containerPort: 8443
      readinessProbe:
        exec:
          command:
          - /home/sfdc/salesforce/casam/bin/ready_probe.sh
        failureThreshold: 99999
        initialDelaySeconds: 120
        periodSeconds: 5
        timeoutSeconds: 5
      resources:
        requests:
          memory: 32Gi
      volumeMounts:
      - mountPath: /home/sfdc/logs/sfdc
        name: log-volume-sfdc
      - mountPath: /home/sfdc/logs/jvm
        name: log-volume-jvm
      - mountPath: /etc/pki_service
        name: tls-client-cert
      - mountPath: /home/sfdc/salesforce/casam
        name: coreapp-casam-volume
      - mountPath: /home/sfdc/salesforce/config/settings/overrides/sp-devmvp-c1
        name: secretvol-c1
        readOnly: true
      - mountPath: /home/sfdc/salesforce/config/settings/overrides/sp-devmvp-pc
        name: secretvol-pc
        readOnly: true
      - mountPath: /home/sfdc/salesforce/config/settings/overrides/gcp-mvp-3az-db-pw
        name: secretvol-db
        readOnly: true
      - mountPath: /var/secrets/google
        name: gcp-svc-creds
        readOnly: true
    - env:
      - name: CASAM_SETTINGS_PATH
        value: prod.-.phx.na3.app
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-gcp/sfci/casam/coreapp_overrides:e0d509
      livenessProbe:
        exec:
          command:
          - cat
          - /tmp/live
        initialDelaySeconds: 10
        periodSeconds: 5
      name: casam-sidecar
      readinessProbe:
        exec:
          command:
          - cat
          - /tmp/ready
        initialDelaySeconds: 10
        periodSeconds: 5
      volumeMounts:
      - mountPath: /home/sfdc/salesforce/casam
        name: coreapp-casam-volume
    - args:
      - |
        "
        cp /cyan-config/tls-terminator-config.yaml.template /home/sfdc-sherpa/tls-terminator-config.yaml ;
        /home/sfdc-sherpa/hot_restarter /home/sfdc-sherpa/envoy -c /home/sfdc-sherpa/tls-terminator-config.yaml --restart-epoch 0 --allow-unknown-fields --max-stats 32768 --drain-time-s 60 --parent-shutdown-time-s 90 --base-id 1
        "
      command:
      - /bin/sh
      - -c
      env:
      - name: SFDC_ENVIRONMENT
        value: envoy-sidecar
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-devmvp/servicelibs/sherpa-envoy:1.0.4
      livenessProbe:
        exec:
          command:
          - echo
          - HEALTHY
        initialDelaySeconds: 20
        periodSeconds: 5
      name: envoy-sidecar
      ports:
      - containerPort: 13065
      - containerPort: 15373
      readinessProbe:
        httpGet:
          path: /
          port: 15373
        initialDelaySeconds: 15
        periodSeconds: 5
      volumeMounts:
      - mountPath: /cyan-config
        name: envoy-config-volume
      - mountPath: /certs/cert-client
        name: tls-client-cert
      - mountPath: /certs/cert-server
        name: tls-server-cert
    - env:
      - name: CONFIG_DIR
        value: /home/sfdc-sherpa/sherpa-envoy-config-volume
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-devmvp/casam/cyan-config:208cc2
      livenessProbe:
        exec:
          command:
          - cat
          - /tmp/live
        initialDelaySeconds: 10
        periodSeconds: 5
      name: envoy-sidecar-config
      readinessProbe:
        exec:
          command:
          - cat
          - /tmp/ready
        initialDelaySeconds: 10
        periodSeconds: 5
      volumeMounts:
      - mountPath: /home/sfdc-sherpa/sherpa-envoy-config-volume
        name: envoy-config-volume
    - args:
      - --switchboard=switchboard.service-mesh.svc:15001
      - --admin-port=15374
      env:
      - name: SFDC_ENVIRONMENT
        value: mesh
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-gcp/sfci/servicelibs/sherpa-envoy:eeb8e3bfc9d7912299ed28658895aca9523f348f
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
        initialDelaySeconds: 20
        periodSeconds: 5
      name: sherpa
      ports:
      - containerPort: 15374
        name: sherpa-adm
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
        initialDelaySeconds: 15
        periodSeconds: 5
      resources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: "1"
          memory: 1Gi
      volumeMounts:
      - mountPath: /client-certs
        name: tls-client-cert
      - mountPath: /server-certs
        name: tls-server-cert
    count: 3
    identity:
      pod: devmvp
      serviceName: app
    name: devmvp-app-gcp
    progressDeadlineSeconds: 300
    strategy:
      rollingUpdate:
        maxSurge: 200%
        maxUnavailable: 0
      type: RollingUpdate
    terminationGracePeriodSeconds: 500
    volumes:
    - emptyDir: {}
      name: envoy-config-volume
    - emptyDir: {}
      name: coreapp-casam-volume
    - maddogCert:
        type: client
      name: tls-client-cert
    - maddogCert:
        type: server
      name: tls-server-cert
    - hostPath:
        path: /mnt/disks/ssd0/data/logs/sfdc
      name: log-volume-sfdc
    - hostPath:
        path: /mnt/disks/ssd0/data/logs/jvm
      name: log-volume-jvm
    - k4aSecret:
        secretName: caas-k4a-secret-sp-cs103-c1
      name: secretvol-c1
    - k4aSecret:
        secretName: caas-k4a-secret-sp-cs103-pc
      name: secretvol-pc
    - k4aSecret:
        secretName: gcp-mvp-3az-db-pw
      name: secretvol-db
    - name: gcp-svc-creds
      secret:
        secretName: casam-gcs-gcpsa
  - containers:
    - args:
      - |
        export SNOWWHITE_PWD=$(cat /db-secrets/gcp-mvp-3az-db-pw/dbpw3az.txt) ;
        /usr/local/bin/run.sh
      command:
      - /bin/sh
      - -c
      env:
      - name: NONCE
        value: 1556737074532731648
      - name: DRY_RUN
        value: 0
      - name: CHATTER_GROUP_NAME
        value: casam-alpha
      - name: SFPROXY_VIP
        value: https://casam.devmvp.gcp.sfdcsvc.net
      - name: SWITCH_BOARD_ADDRESS
        value: na3-switchboard-lb:16001
      - name: RELEASE_VESION
        value: ""
      - name: RELEASE_TYPE
        value: MINOR
      - name: MAJOR_RELEASE_NUMBER
        value: 220
      - name: DB_EDITION
        value: SFDC_220
      - name: MINOR_RELEASE_NUMBER
        value: 0
      - name: PATCH_RELEASE_NUMBER
        value: 0
      - name: CURRENT_RELEASE_VERSION
        value: blue
      - name: NEW_RELEASE_VERSION
        value: green
      - name: READY_SERVER_COUNT
        value: 3
      - name: DB_SID
        value: NADB11
      - name: ENABLE_DB_SCHEMA_UPGRADE
        value: 0
      - name: SET_DEFAULT_ORACLE_EDITION
        value: 0
      - name: OLD_DWARF
        value: sneezy
      - name: KILL_DWARF
        value: 0
      - name: LOCK_DWARF
        value: 0
      - name: TRIGGER_CAFFEINE
        value: 0
      - name: UNLOCK_DWARF
        value: 0
      - name: MADDOG_CLIENT
        value: /certs
      - name: SFPROXY_SETTINGS_PATH
        value: prod.-.phx.na3.sfproxy-envoy
      - name: CASAM_SUPERPOD
        value: '-'
      - name: HTTP_PROXY
        value: localhost:3128
      - name: PUBLIC_PROXY
        value: 10.168.192.105:8444
      - name: SUBSTRATE
        value: public
      - name: SKIP_KAIJU
        value: 0
      - name: ZDT
        value: true
      - name: KAIJU_REFOCUS_GETRESULT_URL
        value: https://refocus.hk.salesforce.com/v1/samples/
      - name: KAIJU_RUNTIME_TIMEOUT_MS
        value: 30000
      - name: dns_override_enabled
        value: true
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-gcp/sfci/casam/sequencer:4a4b1b
      livenessProbe:
        exec:
          command:
          - /usr/local/bin/ready_probe.sh
        failureThreshold: 10
        initialDelaySeconds: 60
        periodSeconds: 1
      name: sequencer
      ports:
      - containerPort: 12062
      readinessProbe:
        exec:
          command:
          - /usr/local/bin/ready_probe.sh
        failureThreshold: 10
        initialDelaySeconds: 60
        periodSeconds: 1
      resources:
        limits:
          cpu: 4
          memory: 10Gi
        requests:
          cpu: 2
          memory: 4Gi
      volumeMounts:
      - mountPath: /certs
        name: tls-client-cert
      - mountPath: /secrets/
        name: secretvol
        readOnly: true
      - mountPath: /kaiju-secrets/
        name: kaiju-secret-vol
        readOnly: true
      - mountPath: /db-secrets/gcp-mvp-3az-db-pw
        name: secretvol-db
        readOnly: true
    - args:
      - --switchboard=switchboard.service-mesh.svc:15001
      - --admin-port=15374
      env:
      - name: SFDC_ENVIRONMENT
        value: mesh
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-gcp/sfci/servicelibs/sherpa-envoy:eeb8e3bfc9d7912299ed28658895aca9523f348f
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
        initialDelaySeconds: 20
        periodSeconds: 5
      name: sherpa
      ports:
      - containerPort: 15372
        name: sherpa-adm
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
        initialDelaySeconds: 15
        periodSeconds: 5
      resources:
        limits:
          cpu: "1"
          memory: 1Gi
        requests:
          cpu: "1"
          memory: 1Gi
      volumeMounts:
      - mountPath: /client-certs
        name: tls-client-cert
      - mountPath: /server-certs
        name: tls-server-cert
    count: 1
    identity:
      pod: devmvp
      serviceName: sequencer
    name: devmvp-sequencer-gcp
    progressDeadlineSeconds: 300
    terminationGracePeriodSeconds: 500
    volumes:
    - maddogCert:
        type: client
      name: tls-client-cert
    - maddogCert:
        type: server
      name: tls-server-cert
    - k4aSecret:
        secretName: gcp-mvp-sequencer-gus
      name: secretvol
    - k4aSecret:
        secretName: gcp-mvp-sequencer-kaiju
      name: kaiju-secret-vol
    - k4aSecret:
        secretName: gcp-mvp-3az-db-pw
      name: secretvol-db
  loadbalancers:
  - function: devmvp-app-gcp
    lbname: devmvp-app-gcp-lb
    nodeExposed: true
    ports:
    - lbtype: tcp
      port: 13065
      targetport: 13065
