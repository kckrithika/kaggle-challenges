apiVersion: v1

system:
  functions:
  - name: na7-mist61sequencer-prd
    identity:
      serviceName: sequencer
      pod: na7
    count: 1
    containers:
    - name: sequencer
      image: sfci/casam/sequencer:bb3dd1
      env:
      - name: NONCE
        value: 1551221682919725056
      - name: DRY_RUN
        value: 1
      - name: CHATTER_GROUP_NAME
        value: casam-alpha
      - name: SFPROXY_VIP
        value: https://us7-sfproxy-lb.core-on-sam-sp2.prd-sam.prd.slb.sfdc.net:8443
      - name: SWITCH_BOARD_ADDRESS
        value: na7-switchboard-lb:16001
      - name: RELEASE_VESION
        value: ""
      - name: RELEASE_TYPE
        value: MINOR
      - name: MAJOR_RELEASE_NUMBER
        value: 220
      - name: MINOR_RELEASE_NUMBER
        value: 0
      - name: PATCH_RELEASE_NUMBER
        value: 0
      - name: CURRENT_RELEASE_VERSION
        value: blue
      - name: NEW_RELEASE_VERSION
        value: green
      - name: READY_SERVER_COUNT
        value: 3
      - name: DB_SID
        value: CSDB6
      - name: ENABLE_DB_SCHEMA_UPGRADE
        value: 0
      - name: SET_DEFAULT_ORACLE_EDITION
        value: 0
      - name: OLD_DWARF
        value: sneezy
      - name: KILL_DWARF
        value: 0
      - name: LOCK_DWARF
        value: 0
      - name: TRIGGER_CAFFEINE
        value: 0
      - name: UNLOCK_DWARF
        value: 0
      - name: MADDOG_CLIENT
        value: /certs
      - name: SFPROXY_SETTINGS_PATH
        value: mist61.-.prd.na7.sfproxy
      - name: CASAM_SUPERPOD
        value: sp2
      - name: HTTP_PROXY
        value: public0-proxy1-0-prd.data.sfdc.net:8080
      - name: SKIP_KAIJU
        value: 1
      - name: KAIJU_REFOCUS_GETRESULT_URL
        value: https://refocus.hk.salesforce.com/v1/samples/
      - name: KAIJU_RUNTIME_TIMEOUT_MS
        value: 30000
      - name: dns_override_enabled
        value: true
      - name: SNOWWHITE_PWD
        value: rotate
      livenessProbe:
        exec:
          command:
          - /usr/local/bin/ready_probe.sh
        failureThreshold: 10
        initialDelaySeconds: 60
        periodSeconds: 1
      readinessProbe:
        exec:
          command:
          - /usr/local/bin/ready_probe.sh
        failureThreshold: 10
        initialDelaySeconds: 60
        periodSeconds: 1
      ports:
      - containerPort: 12062
      volumeMounts:
      - mountPath: /certs
        name: tls-client-cert
      - mountPath: /secrets/
        name: secretvol
        readOnly: true
      - mountPath: /kaiju-secrets/
        name: kaiju-secret-vol
        readOnly: true
    - name: sherpa
      image: sfci/servicelibs/sherpa-envoy:eeb8e3bfc9d7912299ed28658895aca9523f348f
      env:
      - name: SFDC_ENVIRONMENT
        value: mesh
      resources:
        limits: { cpu: "1", memory: "1Gi" }
        requests: { cpu: "1", memory: "1Gi" }
      ports:
      - containerPort: 15372
        name: sherpa-adm
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
        initialDelaySeconds: 20
        periodSeconds: 5
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
        initialDelaySeconds: 15
        periodSeconds: 5
      volumeMounts:
        - name: tls-client-cert
          mountPath: /client-certs
        - name: tls-server-cert
          mountPath: /server-certs
    progressDeadlineSeconds: 300
    terminationGracePeriodSeconds: 500
    volumes:
    - maddogCert:
        type: client
      name: tls-client-cert
    - maddogCert:
        type: server
      name: tls-server-cert
    - k4aSecret:
        secretName: sequencer-gus
      name: secretvol
    - k4aSecret:
        secretName: sequencer-kaiju
      name: kaiju-secret-vol