apiVersion: v1
system:
  functions:
  - containers:
    - env:
      - name: DB_SID
        value: dbsid
      - name: DB_INSTANCE_NAME
        value: dbinstance
      - name: DB_USER
        value: dbuser
      - name: DB_PASSWORD
        value: rotate
      - name: DB_STATS_USER
        value: dbsuperuser
      - name: DB_STATS_PASSWORD
        value: rotate
      - name: DB_CONN_NUM
        value: 25
      - name: PLSQL_UPDATE_RUNSTATS
        value: false
      - name: SERVER_ID
        value: x
      - name: IP_DB
        value: dbhostname
      - name: IP_MNDS1
        value: 127.0.0.1
      - name: OFFLINE
        value: true
      - name: PUBLIC_PORT
        value: 8443
      - name: PUBLIC_PORT_IS_SECURE
        value: true
      - name: PUBLIC_HOST_NAME
        value: us2-sfproxy-lb.publicdnssuffix
      - name: SFPROXY_VIP
        value: https://us2-sfproxy-lb.publicdnssuffix:8443
      - name: HTTP_PORT
        value: 8085
      - name: SPORT
        value: 8443
      - name: S2PORT
        value: 12098
      - name: DISABLE_AUTH_RELEASE_CHECK
        value: true
      - name: CASAM_APP_COLOR
        value: green
      - name: SD_PORT_OVERRIDE
        value: 13065
      - name: CASAM_SETTINGS_PATH
        value: mist1.mist611.prd1.na2.app
      - name: CLUSTER_NAME
        value: na2
      - name: DEPLOYMENT
        value: B
      - name: USE_CONFIG_SIDECAR
        value: 1
      - name: CASAM_HOST_NAME
        valueFrom:
          fieldRef:
            fieldPath: spec.nodeName
      image: coreAppImage
      livenessProbe:
        exec:
          command:
          - echo
          - HEALTHY
        initialDelaySeconds: 480
        periodSeconds: 1
      name: coreapp
      ports:
      - containerPort: 8998
      - containerPort: 8085
      - containerPort: 11211
      - containerPort: 12098
      - containerPort: 8443
      readinessProbe:
        failureThreshold: 10
        httpGet:
          path: /ping.jsp
          port: 8085
        initialDelaySeconds: 120
        periodSeconds: 1
      volumeMounts:
      - mountPath: /home/sfdc/logs/sfdc
        name: log-volume-sfdc
      - mountPath: /home/sfdc/logs/jvm
        name: log-volume-jvm
      - mountPath: /etc/pki_service
        name: tls-client-cert
      - mountPath: /home/sfdc/config_override
        name: coreapp-config-volume
      - mountPath: /home/sfdc/salesforce/config/settings/overrides/caas-cluster-casam-sp2
        name: secretvol
        readOnly: true
    - env:
      - name: CASAM_SETTINGS_PATH
        value: mist1.mist611.prd1.na2.app
      image: configOverrideImage
      livenessProbe:
        exec:
          command:
          - cat
          - /tmp/live
        initialDelaySeconds: 10
        periodSeconds: 5
      name: config-sidecar
      readinessProbe:
        exec:
          command:
          - cat
          - /tmp/ready
        initialDelaySeconds: 10
        periodSeconds: 5
      volumeMounts:
      - mountPath: /home/sfdc/config_override
        name: coreapp-config-volume
    - args:
      - --template
      - /cyan-config/tls-terminator-config.yaml.template
      env:
      - name: SFDC_ENVIRONMENT
        value: envoy-sidecar
      image: envoyImage
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
        initialDelaySeconds: 20
        periodSeconds: 5
      name: envoy-sidecar
      ports:
      - containerPort: 13065
      - containerPort: 15373
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
        initialDelaySeconds: 15
        periodSeconds: 5
      volumeMounts:
      - mountPath: /cyan-config
        name: envoy-config-volume
      - mountPath: /certs/cert-client
        name: tls-client-cert
      - mountPath: /certs/cert-server
        name: tls-server-cert
    - env:
      - name: CONFIG_DIR
        value: /home/sfdc-sherpa/sherpa-envoy-config-volume
      image: envoyConfigImage
      livenessProbe:
        exec:
          command:
          - cat
          - /tmp/live
        initialDelaySeconds: 10
        periodSeconds: 5
      name: envoy-sidecar-config
      readinessProbe:
        exec:
          command:
          - cat
          - /tmp/ready
        initialDelaySeconds: 10
        periodSeconds: 5
      volumeMounts:
      - mountPath: /home/sfdc-sherpa/sherpa-envoy-config-volume
        name: envoy-config-volume
    count: 15
    identity:
      pod: na2
      serviceName: app
    name: na2-mist611app-prd1
    progressDeadlineSeconds: 300
    strategy:
      rollingUpdate:
        maxSurge: 200%
        maxUnavailable: 0
      type: RollingUpdate
    terminationGracePeriodSeconds: 500
    volumes:
    - emptyDir: {}
      name: envoy-config-volume
    - emptyDir: {}
      name: coreapp-config-volume
    - maddogCert:
        type: client
      name: tls-client-cert
    - maddogCert:
        type: server
      name: tls-server-cert
    - hostPath:
        path: /data/logs/sfdc
      name: log-volume-sfdc
    - hostPath:
        path: /data/logs/jvm
      name: log-volume-jvm
    - k4aSecret:
        secretName: caas-k4a-secret-prd
      name: secretvol
  - containers:
    - env:
      - name: NONCE
        value: 1548093954731507968
      - name: DEPLOY_ENV
        value: alpha
      - name: CYAN
        value: https://us2-sfproxy-lb.publicdnssuffix:8086
      - name: CURL_GLOBAL_OPTS
        value: -k
      - name: K4A
        value: have_to_get_this
      - name: ENABLE_DB_SCHEMA_UPGRADE
        value: 1
      - name: SET_DEFAULT_ORACLE_EDITION
        value: 1
      - name: OLD_DWARF
        value: sneezy
      - name: CURRENT_RELEASE_VERSION
        value: blue
      - name: NEW_RELEASE_VERSION
        value: green
      - name: READY_SERVER_COUNT
        value: 15
      - name: DB_SID
        value: dbsid
      - name: LOCK_DWARF
        value: 1
      - name: TRIGGER_CAFFEINE
        value: 1
      - name: UNLOCK_DWARF
        value: 1
      - name: SNOWWHITE_PWD
        value: rotate
      - name: MADDOG_CLIENT
        value: /certs
      - name: CASAM_SETTINGS_PATH
        value: mist1.mist611.prd1.na2.sequencer
      - name: CASAM_SUPERPOD
        value: sp2
      - name: HTTP_PROXY
        value: httpproxy
      image: sequencerImage
      livenessProbe:
        failureThreshold: 10
        httpGet:
          path: /login
          port: 12062
        initialDelaySeconds: 60
        periodSeconds: 1
      name: sequencer
      ports:
      - containerPort: 12062
      readinessProbe:
        failureThreshold: 10
        httpGet:
          path: /login
          port: 12062
        initialDelaySeconds: 60
        periodSeconds: 1
      volumeMounts:
      - mountPath: /certs
        name: cert
      - mountPath: /secrets/
        name: secretvol
        readOnly: true
      - mountPath: /kaiju-secrets/
        name: kaiju-secret-vol
        readOnly: true
    count: 1
    identity:
      pod: na2
      serviceName: sequencer
    name: na2-mist611sequencer-prd1
    progressDeadlineSeconds: 300
    terminationGracePeriodSeconds: 500
    volumes:
    - maddogCert:
        type: client
      name: cert
    - k4aSecret:
        secretName: sequencer-gus
      name: secretvol
    - k4aSecret:
        secretName: sequencer-kaiju
      name: kaiju-secret-vol
  - containers:
    - args:
      - --template=/home/sfdc-sherpa/sfproxy/config/core-on-sam/sfproxy-rds.yaml.template
      - --switchboard=switchboard
      - --log-level=trace
      env:
      - name: ENVOY_DEBUG_OPTIONS
        value: --log-path /home/sfdc-sherpa/envoy.log
      - name: SFDC_ENVIRONMENT
        value: mist611
      image: sfProxy
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
        initialDelaySeconds: 20
        periodSeconds: 5
      name: sfproxy-envoy
      ports:
      - containerPort: 2525
      - containerPort: 12060
      - containerPort: 15373
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
        initialDelaySeconds: 15
        periodSeconds: 5
      volumeMounts:
      - mountPath: /client-certs
        name: tls-client-cert
      - mountPath: /server-certs
        name: tls-server-cert
    count: 1
    identity:
      pod: na2
      serviceName: sfproxy
    name: na2-mist611sfproxy-prd1
    volumes:
    - maddogCert:
        type: client
      name: tls-client-cert
    - maddogCert:
        lbnames:
        - us2-sfproxy-lb
        type: server
      name: tls-server-cert
  loadbalancers:
  - function: na2-mist611sfproxy-prd1
    lbname: us2-sfproxy-lb
    nodeExposed: false
    ports:
    - port: 2525
      targetport: 2525
    - port: 8086
      targetport: 12060
    - port: 8443
      targetport: 12060
    - port: 8087
      targetport: 15373
    - port: 8888
      targetport: 12060
    slbEnabled: true
