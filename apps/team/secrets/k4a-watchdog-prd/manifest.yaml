apiVersion: v1

system:
  functions:
  - name: k4a-watchdog-prd
    count: 1
    containers:
    - name: k4a-watchdog
      image: dva/k4a-caiman-watchdog:176-ed6bfa04d85b0a16db8d43b86305584e06f759ea
      command:
      - "java"
      - "-Duser.home=/tmp"
      - "-jar"
      - "/caiman-watchdog/caiman-watchdog-0.0.15-SNAPSHOT.jar"
      - "-secretsFile"
      - "/caiman-watchdog/classes/sam.secrets.k4a-watchdog.zip"
      - "-certPath"
      - "/clientcert"
      - "-datacenter"
      - "PRD"
      - "-hostname"
      - $(NODE_NAME)
      env:
      - name: NODE_NAME
        valueFrom:
          fieldRef:
            fieldPath: spec.nodeName
      livenessProbe:
        exec:
          command: ["ls", "/"]
        failureThreshold: 3
        initialDelaySeconds: 5
        periodSeconds: 60
      volumeMounts:
      - mountPath: /clientcert
        name: cert
    - name: k4a-watchdog
      image: dva/k4a-caiman-watchdog:176-ed6bfa04d85b0a16db8d43b86305584e06f759ea
      command:
      - "java"
      - "-Duser.home=/tmp"
      - "-jar"
      - "/caiman-watchdog/caiman-watchdog-0.0.15-SNAPSHOT.jar"
      - "-secretsFile"
      - "/caiman-watchdog/classes/sam.secrets.k4a-watchdog.zip"
      - "-certPath"
      - "/clientcert"
      - "-url"
      - "https://sec0-kfora1-1-crd.eng.sfdc.net:8443"
      - "-datacenter"
      - "PRD"
      - "-hostname"
      - $(NODE_NAME)
      env:
      - name: NODE_NAME
        valueFrom:
          fieldRef:
            fieldPath: spec.nodeName
      livenessProbe:
        exec:
          command: ["ls", "/"]
        failureThreshold: 3
        initialDelaySeconds: 5
        periodSeconds: 60
      volumeMounts:
      - mountPath: /clientcert
        name: cert
      - name: podinfo
        mountPath: /etc/podinfo
        readOnly: false
    volumes:
    - name: cert
      maddogCert:
        type: client
