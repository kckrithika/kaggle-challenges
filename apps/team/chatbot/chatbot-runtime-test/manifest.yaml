apiVersion: v1

system:
  notifications:
    email:
      - david.ji@salesforce.com
      - d.l.taylor@salesforce.com
      - joslyn.esser@salesforce.com
  functions:
  - name: chatbot-runtime-test
    count: 1
    volumes:
    - name: logvol
      hostPath:
        path: /home/sfdc-chatbot/logs
    containers:
    - name: chatbot-runtime
      image: ops0-artifactrepo2-0-prd.data.sfdc.net/docker-sfci-rc/chatbots/chatbot-runtime:210.153-SNAPSHOT-8543927
      ports:
      - containerPort: 7022
      env:
      - name: SFDC_ENVIRONMENT
        value: prod
      - name: LOGGING_STDERR_LEVEL
        value: ALL
      - name: METAMIND_PROXY
        value: http://public0-proxy1-0-prd.data.sfdc.net:8080
      - name: METAMIND_EMAIL
        valueFrom:
          secretKeyRef:
            name: chatbot-runtime-metamind-secrets
            key: email
      - name: METAMIND_CERT
        valueFrom:
          secretKeyRef:
            name: chatbot-runtime-metamind-secrets
            key: cert
      - name: CACHE_CLUSTER_NAME
        value: sp-chatbot-c1
      volumeMounts:
      - name: logvol
        mountPath: /home/sfdc-chatbot/logs
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 30
        timeoutSeconds: 5
        periodSeconds: 5
      readinessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 30
        timeoutSeconds: 5
        periodSeconds: 5

  loadbalancers:
  - lbname: chatbot-runtime-test-lb
    function: chatbot-runtime-test
    nodeExposed: true
    ports:
      - port: 17022
        targetport: 7022
