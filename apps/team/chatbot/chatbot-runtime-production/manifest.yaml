apiVersion: v1

system:
  notifications:
    email:
      - david.ji@salesforce.com
      - d.l.taylor@salesforce.com
      - joslyn.esser@salesforce.com
  functions:
  - name: chatbot-runtime-production
    count: 4
    volumes:
    - name: logvol
      hostPath:
        path: /home/sfdc-chatbot/logs
    containers:
    - name: chatbot-runtime
      image: tnrp/chatbots/chatbot-runtime:210.0-46285fc
      ports:
      - containerPort: 7022
      - containerPort: 15372
      env:
      - name: SFDC_ENVIRONMENT
        value: prod
      - name: LOGGING_STDERR_LEVEL
        value: ALL
      - name: METAMIND_EMAIL
        valueFrom:
          secretKeyRef:
            name: chatbot-runtime-metamind-secrets
            key: email
      - name: METAMIND_PRIVATE_KEY
        valueFrom:
          secretKeyRef:
            name: chatbot-runtime-metamind-secrets
            key: private_key
      - name: CACHE_PROVIDER
        value: memory
      volumeMounts:
      - name: logvol
        mountPath: /home/sfdc-chatbot/logs
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 30
        timeoutSeconds: 5
        periodSeconds: 5
      readinessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 30
        timeoutSeconds: 5
        periodSeconds: 5

  loadbalancers:
  - lbname: chatbot-runtime-production-lb
    function: chatbot-runtime-production
    nodeExposed: true
    ports:
      - port: 7022
        targetport: 7022
      - port: 15372
        targetport: 15372
