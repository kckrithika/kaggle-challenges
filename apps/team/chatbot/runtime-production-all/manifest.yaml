---
apiVersion: v1
system:
  functions:
  - containers:
    - env:
      - name: SFDC_ENVIRONMENT
        value: prod
      - name: LOGGING_STDERR_LEVEL
        value: ALL
      - name: METAMIND_API_DOMAIN
        value: api.einstein.ai
      - name: METAMIND_EMAIL
        value: ylin+metamind+prod@salesforce.com
      - name: METAMIND_PRIVATE_KEY
        valueFrom:
          secretKeyRef:
            key: private_key
            name: chatbot-runtime-metamind-secrets
      - name: CACHE_PROVIDER
        value: none
      - name: METRICS_START_PUBLISHER
        value: 'true'
      - name: METRICS_LOG_ONLY_PUBLISHER
        value: 'false'
      image: sfci/chatbots/chatbot-runtime:210.0-f4a4fcd
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 30
        periodSeconds: 5
        timeoutSeconds: 5
      name: chatbot-runtime
      ports:
      - containerPort: 7022
        name: apiport
      - containerPort: 15372
        name: managementport
      readinessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 30
        periodSeconds: 5
        timeoutSeconds: 5
      volumeMounts:
      - mountPath: /home/sfdc-chatbot/logs
        name: logvol
    count: 4
    name: runtime-production
    volumes:
    - hostPath:
        path: /home/sfdc-chatbot/logs
      name: logvol
  loadbalancers:
  - function: runtime-production
    lbname: runtime-production
    nodeExposed: true
    ports:
    - port: 7022
      targetport: 7022
    - port: 15372
      targetport: 15372
  notifications:
    email:
    - david.ji@salesforce.com
    - d.l.taylor@salesforce.com
    - joslyn.esser@salesforce.com
