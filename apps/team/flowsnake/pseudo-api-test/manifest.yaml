apiVersion: v1
system:
  functions:
  - name: kubeapi-test
    count: 1
    progressDeadlineSeconds: 120
    containers:
    - name: virtual-api
      command:
        - /sam/virtual-api
        - --sql-db-host=mysql.flowsnake.prd-sam.prd.slb.sfdc.net
        - --sql-db-port=3306
        - --sql-db-name=kube_resource_test
        - --sql-db-user=root
        - --sql-db-pass-file=/var/secrets/mysql.txt
        - --sql-db-resources-table=k8s_resource
        - --v=10
        - --alsologtostderr
        - --insecure-port=7002
        - --passthrough-api-server=k8sproxy.sam-system.prd-sam.prd.slb.sfdc.net:5000
        - --passthrough-all-cluster=prd-sam
        - --secret-passthrough-namespace=kube-system
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/d.smith/hypersam:20180518_123833.16f51950.dirty.duncsmith-ltm
      ports:
      - containerPort: 7002
      livenessProbe:
        httpGet:
          path: /healthz
          port: 7002
      volumeMounts:
        - mountPath: /var/secrets/
          name: mysql
          readOnly: true
    volumes:
    - name: mysql
      secret:
        secretName: mysql
  loadbalancers:
  - lbname: kubeapi-test
    function: kubeapi-test
    slbEnabled: true
    ports:
      - port: 7002
        targetport: 7002
        lbtype: dsr
