apiVersion: v1

system:
  notifications:
    email:
      - gk-support@salesforce.com
  functions:
  - name: gatekeeper-dashboard
    count: 2
    containers:
    - name: gatekeeper-dashboard
      image: dva/gateway:26-6df4a1f5218934da8de5202123885440d3b3e701
      livenessProbe:
        httpGet:
          path: /rest/deployments/all/Steam/226
          port: 8080
        initialDelaySeconds: 60 
        timeoutSeconds: 10
      ports:
      - containerPort: 8080
      - containerPort: 15372
      - containerPort: 7020
      - containerPort: 8081
      volumeMounts:
      - mountPath: /secrets/
        name: secretvol
        readOnly: true

    volumes:
    - name: secretvol
      k4aSecret:
        secretName: pddb

    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 0
        maxUnavailable: 1

  loadbalancers:
  - lbname: gatekeeper-dashboardlb
    annotations:
      slb.sfdc.net/iptype: private_reserved
    function: gatekeeper-dashboard
    slbEnabled: true
    ports:
      - port: 80
        targetport: 8080
        lbtype: tcp
      - port: 15372
        targetport: 15372
        lbtype: tcp
      - port: 7020
        targetport: 7020
        lbtype: tcp
      - port: 81
        targetport: 8081
        lbtype: tcp
