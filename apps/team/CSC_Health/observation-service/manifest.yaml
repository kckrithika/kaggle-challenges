apiVersion: v1

system:
  functions:
  - name: observation-service
    count: 1
    containers:
    - name: observation-service
      image: observation-service:cmcnair-1.0.0
      resources:
        limits: { cpu: "10", memory: "20Gi" }
        requests: { cpu: "10", memory: "20Gi" }
      volumeMounts:
        - mountPath: /var/secrets
          name: secretvol
          readOnly: true
      env:
      - name: OBS_AJNA_ENABLED
        value: true
      - name: OBS_REPORTCOLLECTOR_ENDPOINT
        value: http://shared0-samminionreportcollector1-1-prd.eng.sfdc.net:18444
      - name: OBS_GROK_ENDPOINT
        value: https://ops0-grok1-0-prd.data.sfdc.net
      - name: OBS_GROK_CERTPATH
        value: /var/secrets/grok-client.crt.pem
      - name: OBS_GROK_KEYPATH
        value: /var/secrets/grok-client.key
      command: ["/bin/sh", "-c"]  
      args: ["
        export OBS_AJNA_FUNNELHOST=${SFDC_METRICS_SERVICE_HOST} ;
        export OBS_AJNA_FUNNELPORT=${SFDC_METRICS_SERVICE_PORT} ;
        export OBS_AJNA_DATACENTER=${KINGDOM} ;
        export OBS_AJNA_DEVICE=${FUNCTION_INSTANCE_NAME} ;
        /main
      "]
    volumes:
      - name: secretvol
        secret:
          secretName: csc-health-secret
