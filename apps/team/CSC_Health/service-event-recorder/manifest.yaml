apiVersion: v1

system:
  functions:
  - name: service-event-recorder
    count: 1
    containers:
    - name: service-event-recorder
      image: tnrp/csc-health/service-event-recorder:service-event-recorder-0000025-e27bba48
      ports:
      - containerPort: 10000
      resources:
        limits: { cpu: "10", memory: "5Gi" }
        requests: { cpu: "10", memory: "5Gi" }
      env:
      - name: SER_GRPC_PORT
        value: 10000
      - name: SER_GUSWAVE_LOGINSERVER
        value: "https://gs0.my.salesforce.com"
      - name: SER_GUSWAVE_USERNAME
        valueFrom:
          secretKeyRef:
            name: csc-health-gus-svc
            key: username
      - name: SER_GUSWAVE_PASSWORD
        valueFrom:
          secretKeyRef:
            name: csc-health-gus-svc
            key: password
      - name: SER_GUSWAVE_OAUTHCLIENTSECRET
        valueFrom:
          secretKeyRef:
            name: csc-health-gus-svc
            key: oauthclientsecret
      - name: SER_GUSWAVE_OAUTHCLIENTKEY
        valueFrom:
          secretKeyRef:
            name: csc-health-gus-svc
            key: oauthclientkey
      - name: SER_GUSWAVE_PROXY
        value: "http://public0-proxy1-0-prd.data.sfdc.net:8080"
      livenessProbe:
        tcpSocket:
          port: 10000
        initialDelaySeconds: 5

  loadbalancers:
  - lbname: serviceeventrecorderlb
    function: service-event-recorder
    ports:
    - port: 80
      targetport: 10000
