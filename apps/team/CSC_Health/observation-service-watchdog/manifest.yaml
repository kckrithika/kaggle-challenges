apiVersion: v1

system:
  functions:
  - name: observation-service-watchdog
    count: 1
    containers:
    - name: observation-service-watchdog
      image: tnrp/csc-health/health-endpoint-watchdog:health-endpoint-watchdog-0000007-8a85aa82
      resources:
        limits: { cpu: "1", memory: "2Gi" }
        requests: { cpu: "1", memory: "2Gi" }
      livenessProbe:
        exec:
          command:
          - echo
          - always_healthy
      env:
      - name: HEWD_AJNA_ENABLED
        value: true
      - name: HEWD_AJNA_SERVICE
        value: observation-service
      - name: HEWD_TARGET_DISPLAYNAME
        value: "Observation Service"
      - name: HEWD_PUBLISHPRODUCTIONAVAILABILITYMETRIC
        value: true
      - name: HEWD_LOGLEVEL
        value: debug
      command: ["/bin/sh", "-c"]
      args: ["
        export HEWD_AJNA_FUNNELENDPOINT=http://${SFDC_METRICS_SERVICE_HOST}:${SFDC_METRICS_SERVICE_PORT} ;
        export HEWD_AJNA_DATACENTER=${KINGDOM} ;
        export HEWD_AJNA_DEVICE=${ESTATE}.${FUNCTION_NAMESPACE}.${FUNCTION}.${FUNCTION_INSTANCE_NAME} ;
        export HEWD_TARGET_ENDPOINT=http://${OBSERVATIONSERVICELB_SERVICE_HOST}:${OBSERVATIONSERVICELB_SERVICE_PORT} ;
        /health-endpoint-watchdog
      "]
