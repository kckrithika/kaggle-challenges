apiVersion: v1

system:
  functions:
  - name: report-collectorha
    count: 3
    containers:
    - name: report-collectorha
      image: report-collector:1.2.0-SNAPSHOT10292016T220000
      ports:
      - name: provider
        containerPort: 8080
        hostPort: 18080
      - name: consumer
        containerPort: 8081
        hostPort: 18081
      - name: provider-https
        containerPort: 8443
        hostPort: 18443
      - name: consumer-https
        containerPort: 8444
        hostPort: 18444
      resources:
        limits: { cpu: "10", memory: "20Gi" }
        requests: { cpu: "10", memory: "20Gi" }
      logs:
      - directory: /var/log/report-collector
      env:
      - name: ReportCollector_redis_host
        value: $(REDISLB_SERVICE_HOST)
  - name: redisnoha
    count: 1
    containers:
    - name: redis
      image: rc-redis:3.0
      ports:
      - containerPort: 6379
      resources:
        limits: { cpu: "2", memory: "10Gi" }
        requests: { cpu: "2", memory: "10Gi" }
      logs:
      - directory: /var/log/redis

  loadbalancers:
  - lbname: reportcollectorlb
    function: report-collectorha
    nodeExposed: true
    ports:
      - port: 8080
        targetport: 8080
      - port: 8081
        targetport: 8081
      - port: 8443
        targetport: 8443
      - port: 8444
        targetport: 8444
  - lbname: redislb
    function: redisnoha
    nodeExposed: true
    ports:
      - port: 6379
        targetport: 6379
