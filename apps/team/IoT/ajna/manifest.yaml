apiVersion: v1

system:
  functions:
  - name: ajna
    count: 1
    containers:
    - name: idb
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/idb:latest
      livenessProbe:
        exec:
          command:
            - ls
        initialDelaySeconds: 60
      ports:
      - containerPort: 8080

    - name: mandm-zookeeperp
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/mandm-zookeeper:latest
      livenessProbe:
        exec:
          command:
            - ls
        initialDelaySeconds: 60
      ports:
      - containerPort: 2181

    - name: mandm-kafka
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/mandm-kafka:latest
      env:
        - name: KAfKA_HOST
          value: localhost
        - name: KAFKA_PORT
          value: 6667
        - name: ZOOKEEPER_HOST
          value: localhost
        - name: ZOOKEEPER_PORT
          value: 2181
      livenessProbe:
        exec:
          command:
            - ls
        initialDelaySeconds: 60
      ports:
      - containerPort: 6667

    - name: graphite-kafka-consumer
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/graphite-kafka-consumer:latest
      env:
        - name: KAfKA_HOST
          value: localhost
        - name: KAFKA_PORT
          value: 6667
        - name: ZOOKEEPER_HOST
          value: localhost
        - name: ZOOKEEPER_PORT
          value: 2181
        - name: GRAPHITE_HOST
          value: localhost
        - name: GRAPHITE_PORT
          value: 8003
      livenessProbe:
        exec:
          command:
            - ls
        initialDelaySeconds: 60

    - name: mandm-funnel
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/mandm-funnel:latest
      env:
        - name: KAfKA_HOST
          value: localhost
        - name: KAFKA_PORT
          value: 6667
      livenessProbe:
        exec:
          command:
            - ls
        initialDelaySeconds: 60
      ports:
      - containerPort: 8080


    - name: graphite
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/graphite-statsd:latest
      livenessProbe:
        exec:
          command:
            - ls
        initialDelaySeconds: 60
      ports:
      - containerPort: 8003
      - containerPort: 80

  loadbalancers:
  - lbname: ajna
    function: ajna
    nodeExposed: true
    ports:
      - port: 8090
        targetport: 80
      - port: 8091
        targetport: 8003
      - port: 8092
        targetport: 8080
      - port: 8093
        targetport: 6667
      - port: 8094
        targetport: 2181
