####################################################################################
# Warning: Do not edit this file directly, your changes will be overwritten!       #
# This file is managed by https://git.soma.salesforce.com/IoT/enterprise-manifests #
# This file is Generated from commit version 1876fc5bc8fe14681ab52e3932932c848eee7c58
# Make your edits there and follow instructions in the README to persist changes.  #
####################################################################################

apiVersion: v1
system:
  functions:
  - containers:
    - env:
      - name: AQUEDUCT_HOST
        value: int1shared0-internal-emp-aqueduct1-0-prd.data.sfdc.net
      - name: BUILD_NUMBER
        value: 1
      - name: COMPILER_CORES
        value: '2'
      - name: COMPILER_MEMORY
        value: 8 gigabytes
      - name: COMPILER_REPLICAS
        value: '1'
      - name: COMPILER_STORM_JAR_JVM_OPTS
        value: -XX:MaxMetaspaceSize=512m -Xmx6g -Xms6g
      - name: COMPILER_TAG
        value: 1.0.0.9
      - name: ENV_ENDPOINTS
        value: intake-bridge/manage/health,compiler/health
      - name: ENV_EXTERNAL_ZOOKEEPER
        value: 'true'
      - name: ENV_FLOWSNAKE_MANIFEST
        value: '{"applications": [{"cores": "{{ INTAKE_CORES }}", "dependencies":
          [ ], "environmentVariables": {"AQUEDUCT_HOST": "{{ AQUEDUCT_HOST }}", "AQUEDUCT_PORT":
          "443", "AQUEDUCT_SSL_ENABLED": "true", "CONTROLPLANE_ENDPOINT": "controlplane.iot.localhost.mesh.force.com:5443",
          "HBASE_SECURITY_KEYTAB_SERVICE_ENABLED": "true", "JAVA_OPTS": "{{ INTAKE_JAVA_OPTS
          }}", "JENKINS_BUILD_NUMBER": "{{ BUILD_NUMBER }}", "KAFKA_API_HOST": "topicsapi.ajna-zk.localhost.mesh.force.com",
          "KAFKA_API_PORT": "5442", "KAFKA_API_SERVICEMESH_ENABLED": "true", "KAFKA_CLIENTID":
          "{{ KAFKA_CLIENT_ID }}", "KAFKA_DEFAULTPARTITIONS": "9", "KAFKA_DEFAULTREPLICAS":
          "3", "KAFKA_KEYSTORE_FORMAT": "PKCS12", "KAFKA_KEYSTORE_LOCATION": "/etc/flowsnake/secrets/p12cert/hostcert-chain.p12",
          "KAFKA_NAMESPACE": "{{ KAFKA_NAMESPACE }}", "KAFKA_TRUSTSTORE_LOCATION":
          "/home/ingestion/cacerts", "LOGGING_JSON_STDOUT_LEVEL": "ALL", "MANAGEMENT_PORT":
          "15372", "METRICS_FUNNELURL": "http://{{ SFDC_METRICS_SERVICE_HOST }}:{{
          SFDC_METRICS_SERVICE_PORT }}", "ORGANIZATIONIDS": "{{ ORG }}", "PHOENIX_DATACENTER":
          "{{ KINGDOM }}", "PHOENIX_ENVIRONMENT": "{{ HBASE_ENVIRONMENT }}", "PHOENIX_KEYTABPATH":
          "/tmp/iot.keytab", "PHOENIX_KEYTABPRINCIPAL": "iot", "PHOENIX_KEYTABUSER":
          "iot", "PKI_CA_LOCATION": "/certs", "PKI_CLIENT_MONITORED_LOCATION": "/certs/client",
          "PKI_ENABLED": "true", "PROCESSOR_TIMEOUTMILLIS": "300000", "PROCESSOR_TYPE":
          "AT_LEAST_ONCE", "SERVICEDISCOVERY_IDB_BASEURL": "https://cfg0-cidbapima1-0-{{
          KINGDOM }}.data.sfdc.net/cidb-api", "SETTINGS_PATH": "{{ SFDC_ENVIRONMENT
          }}.-.{{ KINGDOM }}.-.intake-bridge", "SFDC_ENVIRONMENT": "{{ SFDC_ENVIRONMENT
          }}", "SFDC_SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.intake-bridge",
          "SKIP_SECRETS": "yes"}, "exposeAsExternalWebservice": true, "image": {"image":
          "sfci/iot/enterprise-ingestion:{{ INTAKE_TAG }}", "kind": "dockerDefaultRegistryImage"},
          "kind": "CustomDockerContainer", "memory": "{{ INTAKE_MEMORY }}", "name":
          "intake-bridge", "pkiNameOverride": "intake-bridge", "replicaCount": "{{
          INTAKE_REPLICAS }}", "serviceMeshClient": {"enableAdminPort": false, "environmentVariables":
          {"SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.intake-bridge",
          "SFDC_ENVIRONMENT": "{{ SFDC_ENVIRONMENT }}", "SFDC_SETTINGS_PATH": "{{
          SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.intake-bridge"}, "image": {"image":
          "sfci/servicelibs/sherpa:2.0.26", "kind": "dockerDefaultRegistryImage"},
          "resources": {"cores": 1, "jvmHeapSize": "1 gigabyte", "memory": "1536 megabytes"}},
          "servicePort": 15372}, {"cores": "{{ COMPILER_CORES }}", "dependencies":
          [{"kind": "Storm", "name": "processing"}], "environmentVariables": {"CUSTOMER_LOGGING":
          "1", "ENRICHMENTSVC_HOST": "enrichment.iot.localhost.mesh.force.com:5443",
          "ENV_ORG_ID": "{{ ORG }}", "HBASE_DATACENTER": "{{ KINGDOM }}", "HBASE_ENVIRONMENT":
          "{{ HBASE_ENVIRONMENT }}", "HBASE_KEYTAB_PATH": "/tmp/iot.keytab", "HBASE_KEYTAB_PRINCIPAL":
          "iot", "HBASE_SECURITY_KEYTAB_SERVICE_ENABLED": "true", "JAVA_EXTRA_OPTS":
          "{{ COMPILER_STORM_JAR_JVM_OPTS }}", "JENKINS_BUILD_NUMBER": "{{ BUILD_NUMBER
          }}", "KAFKA_API_HOST": "topicsapi.ajna-zk.localhost.mesh.force.com:5442",
          "KAFKA_API_SERVICEMESH_ENABLED": "true", "KAFKA_CLIENT_ID": "{{ KAFKA_CLIENT_ID
          }}", "KAFKA_NAMESPACE": "{{ KAFKA_NAMESPACE }}", "METRICS_FUNNELURL": "http://{{
          SFDC_METRICS_SERVICE_HOST }}:{{ SFDC_METRICS_SERVICE_PORT }}", "OUTPUTS_POST_URL":
          "{{ OUTPUTS_POST_URL }}", "PIPELINE_TESTING_GENERATE_EVENTS_ENABLED": "true",
          "PKI_CA_LOCATION": "/certs", "PKI_CLIENT_MONITORED_LOCATION": "/certs/client",
          "PKI_ENABLED": "true", "SERVICEDISCOVERY_IDB_BASEURL": "https://cfg0-cidbapima1-0-{{
          KINGDOM }}.data.sfdc.net/cidb-api", "SERVICEDISCOVERY_IDB_DATACENTER": "{{
          KINGDOM }}", "SERVICE_DATACENTER": "{{ KINGDOM }}", "SETTINGS_PATH": "{{
          SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.compiler", "SFDC_ENVIRONMENT": "{{
          SFDC_ENVIRONMENT }}", "SFDC_SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{
          KINGDOM }}.-.compiler", "UNIVERSALSEARCH_URL": "universal-search.universal-search.localhost.mesh.force.com:5443",
          "ZOOKEEPER_HOSTS": "{{ ZOOKEEPER_HOSTS }}"}, "exposeAsExternalWebservice":
          true, "image": {"image": "sfci/iot/enterprise-processing:{{ COMPILER_TAG
          }}", "kind": "dockerDefaultRegistryImage"}, "kind": "CustomDockerContainer",
          "memory": "{{ COMPILER_MEMORY }}", "name": "compiler", "replicaCount": "{{
          COMPILER_REPLICAS }}", "serviceMeshClient": {"enableAdminPort": false, "environmentVariables":
          {"SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.compiler", "SFDC_ENVIRONMENT":
          "{{ SFDC_ENVIRONMENT }}", "SFDC_SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{
          KINGDOM }}.-.compiler"}, "image": {"image": "sfci/servicelibs/sherpa:2.0.26",
          "kind": "dockerDefaultRegistryImage"}, "resources": {"cores": 1, "jvmHeapSize":
          "1 gigabyte", "memory": "1536 megabytes"}}, "servicePort": 8888}, {"consumedStreams":
          [ ], "environmentVariables": {"DUMMY_CONTAINER": "true", "SETTINGS_PATH":
          "{{ SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.processing", "SFDC_ENVIRONMENT":
          "{{ SFDC_ENVIRONMENT }}", "SFDC_SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{
          KINGDOM }}.-.processing", "ZOOKEEPER_HOSTS": "{{ ZOOKEEPER_HOSTS }}"}, "exposeStormUi":
          false, "kind": "Storm", "logLevels": null, "name": "processing", "producedStreams":
          [ ], "serviceMeshClient": {"enableAdminPort": false, "environmentVariables":
          {"SETTINGS_PATH": "{{ SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.processing",
          "SFDC_ENVIRONMENT": "{{ SFDC_ENVIRONMENT }}", "SFDC_SETTINGS_PATH": "{{
          SFDC_ENVIRONMENT }}.-.{{ KINGDOM }}.-.processing"}, "image": {"image": "sfci/servicelibs/sherpa:2.0.26",
          "kind": "dockerDefaultRegistryImage"}, "resources": {"cores": 1, "jvmHeapSize":
          "1 gigabyte", "memory": "1536 megabytes"}}, "storage": {"storageType": "containerTransient"},
          "submitter": {"cores": "{{ SUBMITTER_CORES }}", "jvmHeapSize": "{{ SUBMITTER_HEAP
          }}", "memory": "{{ SUBMITTER_MEMORY }}"}, "submitterContainer": {"image":
          "sfci/iot/enterprise-processing:{{ COMPILER_TAG }}", "kind": "dockerDefaultRegistryImage"},
          "worker": {"cores": "{{ WORKER_CORES }}", "jvmHeapSize": "{{ WORKER_HEAP
          }}", "memory": "{{ WORKER_MEMORY }}", "replicaCount": "{{ WORKER_REPLICAS
          }}"}}], "flowsnakeVersion": "{{ FLOWSNAKE_PLATFORM_VERSION }}", "streams":
          [ ]}'
      - name: ENV_MAX_RETRY_DELAY
        value: '30'
      - name: ENV_NAMESPACE
        value: iot
      - name: ENV_ORGS
        value: '500000000000009'
      - name: ENV_ORGS_CONFIG
        value: '{"500000000000009": {"OUTPUTS_POST_URL": "https://iottest.stmfa.stm.force.com/publicSite/services/apexrest/HighVolumeOutputEvent"}}'
      - name: ENV_ORGS_TO_REMOVE
        value: 50000000GAMEDAY
      - name: ENV_PREFIX
        value: iot-prd-staging-
      - name: ENV_UPGRADE
        value: 'true'
      - name: FLOWSNAKE_OWNER_GROUP
        value: iot-rm-flowsnake
      - name: FLOWSNAKE_PLATFORM_VERSION
        value: 0.9.10
      - name: FLOWSNAKE_URL
        value: http://api-dev.flowsnake.localhost.mesh.force.com:5442
      - name: FLOWSNAKE_USE_PKI
        value: 'true'
      - name: HBASE_ENVIRONMENT
        value: kingdom-test
      - name: INTAKE_CORES
        value: '2'
      - name: INTAKE_JAVA_OPTS
        value: -Xmx6g -Xms6g
      - name: INTAKE_MEMORY
        value: 8 gigabytes
      - name: INTAKE_REPLICAS
        value: '1'
      - name: INTAKE_TAG
        value: 1.0.0.10
      - name: JAVA_OPTS
        value: -server -XX:MaxMetaspaceSize=128m -Xmx512m -Xms512m
      - name: KAFKA_CLIENT_ID
        value: iotrm_integ
      - name: KAFKA_NAMESPACE
        value: sfdc.test.iot.integration
      - name: LOGGING_JSON_STDOUT_LEVEL
        value: all
      - name: LOGGING_STDERR_LEVEL
        value: ALL
      - name: OUTPUTS_POST_URL
        value: ''
      - name: SERVICE_DATACENTER
        value: PRD
      - name: SFDC_ENVIRONMENT
        value: staging
      - name: SUBMITTER_CORES
        value: '1'
      - name: SUBMITTER_HEAP
        value: 1 gigabytes
      - name: SUBMITTER_MEMORY
        value: 1200 megabytes
      - name: WORKER_CORES
        value: '4'
      - name: WORKER_HEAP
        value: 4 gigabytes
      - name: WORKER_MEMORY
        value: 8 gigabytes
      - name: WORKER_REPLICAS
        value: '4'
      - name: ZOOKEEPER_CORES
        value: '1'
      - name: ZOOKEEPER_HEAP
        value: 512 megabytes
      - name: ZOOKEEPER_MEMORY
        value: 1 gigabytes
      image: sfci/iot/enterprise-provisioning:1.0.0.26
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 300
        timeoutSeconds: 120
      name: provisioning-staging
      ports:
      - containerPort: 15372
        name: mgmt
      - containerPort: 7020
        name: grpc
      - containerPort: 8080
        name: http
      resources:
        limits:
          cpu: 2
          memory: 1G
        requests:
          cpu: 1
          memory: 1G
      volumeMounts:
      - mountPath: /home/provisioning/logs
        name: logvol
      - mountPath: /home/provisioning/certs
        name: client-certs
    - env:
      - name: SFDC_ENVIRONMENT
        value: staging
      image: sfci/servicelibs/sherpa:2.0.26
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
        initialDelaySeconds: 10
        periodSeconds: 5
      name: sherpa
      ports:
      - containerPort: 7012
        name: sherpa-in
      - containerPort: 7443
        name: sherpa-tls
      - containerPort: 15373
        name: sherpa-adm
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
        initialDelaySeconds: 5
        periodSeconds: 5
      volumeMounts:
      - mountPath: /server-certs
        name: server-certs
      - mountPath: /client-certs
        name: client-certs
    - args:
      - -endpoint
      - iot/provisioning:DATACENTER:7443
      env:
      - name: SFDC_ENVIRONMENT
        value: staging
      image: sfci/servicelibs/beacon:853c4db9f14805018be6f5e7607ffe65b5648822
      livenessProbe:
        exec:
          command:
          - /home/scone/is-alive.sh
        initialDelaySeconds: 5
      name: beacon
    count: 1
    identity:
      serviceName: provisioning
    name: provisioning-staging
    strategy:
      type: Recreate
    volumes:
    - maddogCert:
        type: server
      name: server-certs
    - maddogCert:
        type: client
      name: client-certs
    - hostPath:
        path: /data/sam/iot/log/provisioning-staging
      name: logvol
  - containers:
    - image: ops0-artifactrepo2-0-prd.data.sfdc.net/sfci/iot/enterprise-ingestion:1.0.0.10
      livenessProbe:
        httpGet:
          path: /health
      name: provisioning-staging-ingestion
    count: 0
    name: provisioning-staging-ingestion
  - containers:
    - image: ops0-artifactrepo2-0-prd.data.sfdc.net/sfci/iot/enterprise-processing:1.0.0.9
      livenessProbe:
        httpGet:
          path: /health
      name: provisioning-staging-processing
    count: 0
    name: provisioning-staging-processing
  loadbalancers:
  - function: provisioning-staging
    lbname: provisioning-staging-lb
    ports:
    - port: 7020
      targetport: 7012
    - lbtype: http
      port: 15372
      targetport: 15372
    - port: 7022
      targetport: 8080
    slbEnabled: true
  notifications:
    email:
    - iot-infra@salesforce.com
