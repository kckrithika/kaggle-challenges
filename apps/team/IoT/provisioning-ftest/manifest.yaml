####################################################################################
# Warning: Do not edit this file directly, your changes will be overwritten!       #
# This file is managed by https://git.soma.salesforce.com/IoT/enterprise-manifests #
# Make your edits there and follow instructions in the README to persist changes.  #
####################################################################################

apiVersion: v1
system:
  functions:
  - containers:
    - env:
      - name: LOGGING_STDERR_LEVEL
        value: ALL
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/iot/enterprise-provisioning:inttest_w-4541361-9b5baa2
      livenessProbe:
        httpGet:
          path: /manage/health
          port: 15372
        initialDelaySeconds: 120
        timeoutSeconds: 120
      name: provisioning-ftest
      ports:
      - containerPort: 15372
        name: mgmt
      - containerPort: 7020
        name: grpc
      - containerPort: 8080
        name: http
      resources:
        limits:
          cpu: 2
          memory: 4G
        requests:
          cpu: 1
          memory: 1G
      volumeMounts:
      - mountPath: /home/provisioning/certs
        name: certs
        readOnly: true
    - env:
      - name: SFDC_ENVIRONMENT
        value: sam
      image: tnrp/sherpa:2-0000127-5d8bf4ab
      livenessProbe:
        exec:
          command:
          - ./bin/is-alive
          initialDelaySeconds: 10
          periodSeconds: 5
      name: sherpa
      ports:
      - containerPort: 7012
        name: sherpa-in
      - containerPort: 7443
        name: sherpa-tls
      - containerPort: 15373
        name: sherpa-adm
      readinessProbe:
        exec:
          command:
          - ./bin/is-ready
          initialDelaySeconds: 5
          periodSeconds: 5
      volumeMounts:
      - mountPath: /server-certs
        name: server-certs
    count: 1
    name: provisioning-ftest
    strategy:
      type: Recreate
    volumes:
    - maddogCert:
        type: client
      name: certs
    - maddogCert:
        type: server
      name: server-certs
  loadbalancers:
  - function: provisioning-ftest
    lbname: provisioning-ftest-lb
    nodeExposed: true
    ports:
    - port: 7021
      targetport: 7012
    - port: 15373
      targetport: 15372
    - port: 8101
      targetport: 8080
    slbEnabled: true
  notifications:
    email:
    - iotenterprise@salesforce.com
