apiVersion: v1

system:
  functions:
  - name: stateful-grill-ceph-2 
    type: stateful-set
    count: 2
    containers:
      - name: stateful-ceph-io
        image: tnrp/legostore/grill_ceph:v1-0000007-252062b3 
        command:
          - /bin/grill_ceph
        ports:
        - containerPort: 9099
          name: web
        volumeMounts:
        - name: www
          mountPath: /rbd/html
        livenessProbe:
            httpGet:
              path: /
              port: 9098
      - name: sfms
        image: tnrp/storagecloud/sfms:latest-0000166-d11c49fe
        command:
          - /opt/sfms/bin/sfms
        args:
        - -j
        - prometheus
        env:
        - name: SFDC_FUNNEL_VIP
          value: ajna0-funnel1-0-prd.data.sfdc.net:80
        - name: MC_KINGDOM
          value: prd 
        - name: MC_ESTATE
          value: prd-sam_storage
        - name: MC_NAME
          value: grill_ceph
        - name: MC_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: MC_NODE
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: MC_DEVICE
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        livenessProbe:
          exec:
            command:
            - touch 
            - /tmp/healthy
    lbname: stateful-lb1
    terminationGracePeriodSeconds: 33
    volumeClaimTemplates:
    - name: www
      storageClassName: small-hdd-pool
      storageSizeRequest: 500Gi
  loadbalancers:
  - lbname: grill-ceph-lb
    function: stateful-grill-ceph-2
    slbenabled: true
    ports:
      - port: 9099
        targetport: 9099
