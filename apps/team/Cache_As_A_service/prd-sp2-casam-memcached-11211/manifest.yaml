apiVersion: v1
 
system:
  functions:
  - name: csrmemcached

    count: 1
    
    hostnetwork: true

    containers:
    - name: csrmemcached-sam
      image: tnrp/casam/coreapp:208.4-0000023-c7e65039
      command: ["/home/sfdc/tools/Linux/memcached/1.4.24.2/x86_64/centos7/bin/memcached"]
      args: ["-p","11211", "-m","128", "-t","16", "-vv"]

      resources:
        limits: { memory: "200M" }
 
      livenessProbe:
        tcpSocket:
          port: 11211
        initialDelaySeconds: 4
        periodSeconds: 1

      readinessProbe:
        tcpSocket:
          port: 11211
        initialDelaySeconds: 1
        periodSeconds: 1
        failureThreshold: 3

      ports:
        # Actually used by the container
        - containerPort: 11211
        # To avoid conflicts with CaaS perf hosts
        - containerPort: 12000
        - containerPort: 12015
        
  loadbalancers:
  - lbname: csrmemcachedlb
    function: csrmemcached
    nodeExposed: true
    ports:
    - port: 11212
      targetport: 11211
