apiVersion: v1

system:
    notifications:
      email:
        - rpothana@salesforce.com
        - sravanthi.konduru@salesforce.com
        - aborra@salesforce.com
    functions:
    - name: fawkes-stage-api
      identity:
        serviceName: fawkes
      count: 1
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: fawkes-stage-api
        image: dva/casp/fawkes_api_strata:jenkins-CASP-fawkes-PR-141-11-itest
        ports:
          - name: fawkes-http
            containerPort: 5000
        env:
        - name: FAWKES_ENV
          value: "stg"
        volumeMounts:
        - mountPath: /certs
          name: fawkes-stage-cert
        - mountPath: /fawkes/mongo-secrets
          name: mongo
          readOnly: true
        - mountPath: /fawkes/mongo-admin-secrets
          name: mongo-admin
          readOnly: true
        livenessProbe:
          exec:
            command: ["/bin/true"]
          initialDelaySeconds: 120
          periodSeconds: 60
      volumes:
      - name: fawkes-stage-cert
        maddogCert:
          type: server
          lbnames:
            - fawkes-stage
      - name: mongo
        k4aSecret:
          secretName: fawkes-mongo
      - name: mongo-admin
        k4aSecret:
          secretName: fawkes-mongo-admin
    loadbalancers:
      - lbname: fawkes-stage
        function: fawkes-stage-api
        slbenabled: true
        ports:
          - port: 443
            targetport: 5000
            lbtype: http
            tls: true
            reencrypt: true
            lbalgorithm: roundrobin
