apiVersion: v1

system:
  notifications:
    email:
      - warden.intelligence@salesforce.com
  functions:
    - name: fawkes-mongo-rs-stg-func
      count: 3
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
        - name: fawkes-mongo-rs-stg-func
          image: dva/casp/mongodb_strata:jenkins-CASP-mongodb-rs-PR-8-2-itest
          env: 
          - name: RELEASE_VAR
            value: "9.0.1"
          ports:
            - name: http
              containerPort: 27017
              hostPort: 27017
          volumeMounts:
            - mountPath: /data/db
              name: fawkes-mongo-data-stg
            - mountPath: /var/log/monogodb
              name: fawkes-mongo-logs-stg
            - mountPath: /fawkes/mongo-rs-key
              name: mongo-key
              readOnly: true
          livenessProbe:
            exec:
              command: ["/bin/true"]
      volumes:
        - name: fawkes-mongo-data-stg
          hostPath:
            path: /data/fawkes-db-stg
        - name: fawkes-mongo-logs-stg
          hostPath:
            path: /data/fawkes-db-logs-stg
        - name: mongo-key
          k4aSecret:
            secretName: mongo-rs-key
