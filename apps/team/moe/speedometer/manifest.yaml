apiVersion: v1

system:
  functions:
  - name: speedometer
    count: 1
    containers:
    - name: speedometer
      image: dva/moe/speedometer:2040-c5e2a439bdf21e01468c293c07012926b1fd7621
      command: ["/moe/speedometer"]
      args:
      - "-gheTokenPath"
      - "/secrets/ghe_pat"
      - "-afwPR"
      - "8085"
      - "-log_dir"
      - "/host/data/speedometer/logs"
      - "-tnrpImagePrefixMapPath"
      - "image_prefixes.yaml"
      - "-webfilesPath"
      - "/moe/webfiles"
      ports:
      - containerPort: 8080
      livenessProbe:
        httpGet:
          path: /
          port: 8080
      volumeMounts:
      - mountPath: /host/data/speedometer/logs
        name: logvol
      - mountPath: /secrets
        name: speedometer-ghe-pat
        readOnly: true
    volumes:
    - name: logvol
      hostPath:
        path: /data/speedometer/logs
    - name: speedometer-ghe-pat
      k4aSecret:
        secretName: speedometer-ghe-pat
  loadbalancers:
  - lbname: speedometer
    function: speedometer
    slbenabled: true
    ports:
      - port: 80
        targetport: 8080
        lbtype: http