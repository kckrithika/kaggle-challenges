apiVersion: v1

system:
  functions:
  - name: payloadbot
    count: 1
    containers:
    - name: payloadbot
      image: dva/moe/payloadbot:2207-e7b9ccab27934205f59fc594c324e42ad8b03ebc
      command: ["/moe/payloadbot"]
      args:
      - "-gheTokenPath=/secrets/ghe_pat"
      - "-imagePrefixMapPath=image_prefixes.yaml"
      - "-includedTeamsListPath=/moe/included_teams.yaml"
      - "-maxCommentedOnSourcePRs=0"
      - "-manifestOrg=sam"
      - "-feedbackURL=https://docs.google.com/forms/d/e/1FAIpQLSdDQQ15L6_zGIwboX3QQIMYQBuyJDjGqRMsBhZatF3CebUHOg/viewform"
      - "-heartbeat.defaultdecayduration=3m"
      ports:
      - containerPort: 8080
      livenessProbe:
        httpGet:
          path: /healthz
          port: 8080
        initialDelaySeconds: 300
        periodSeconds: 60
      volumeMounts:
      - mountPath: /secrets
        name: payloadbot-ghe-pat
        readOnly: true
    volumes:
    - name: payloadbot-ghe-pat
      k4aSecret:
        secretName: speedometer-ghe-pat
  loadbalancers:
  - lbname: payloadbot
    function: payloadbot
    slbenabled: true
    ports:
      - port: 80
        targetport: 8080
        lbtype: http
      - port: 443
        targetport: 8080
        lbtype: http
        tls: true