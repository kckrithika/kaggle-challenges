apiVersion: v1

system:
  functions:
  - name: prod-debug
    count: 1

    containers:
      - name: prod-debug-service
        image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/hubs/prod-debug:prod-debug-2019-10-01-04-51-11
        ports:
          - containerPort: 2022
        livenessProbe:
          exec:
            command:
            - cat
            - /tmp/live
          initialDelaySeconds: 10
          periodSeconds: 5
        readinessProbe:
         exec:
          command:
          - cat
          - /tmp/ready
         initialDelaySeconds: 10
         periodSeconds: 5

      - name: prod-debug-sherpa
        image: sfci/servicelibs/sherpa-envoy:1.0.8
        ports:
        - containerPort: 15373
          name: sherpa-adm
        livenessProbe:
          exec:
            command:
            - ./bin/is-alive
          initialDelaySeconds: 60
          periodSeconds: 5
        volumeMounts:
        - name: tls-client-cert
          mountPath: /client-certs
        - name: tls-server-cert
          mountPath: /server-certs

    # The volumes to mount for shipping logs to splunk
    # General rule is to use path that satisfies the pattern: /home/sfdc-*/logs/**/*.json
    
    volumes:
      - maddogCert:
          type: client
        name: tls-client-cert
      - maddogCert:
          type: server
        name: tls-server-cert
