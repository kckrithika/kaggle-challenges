apiVersion: v1
system:
  notifications:
    email:
      - awaterman@salesforce.com
  functions:
  - name: mta
    count: 3 
    terminationGracePeriodSeconds: 35
    containers:
    - name: mta
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-gcp/dva/sfdc-mta:6
      ports:
      - name: smtp 
        containerPort: 25
      env:
      - name: SFDC_ENVIRONMENT
        value: prd
      - name: SCONE_SERVICE_NAME
        value: mta 
      livenessProbe:
        exec:
          command:
            - /bin/sh
            - -c
            - echo QUIT\r\n | nc localhost 25
        initialDelaySeconds: 120
        periodSeconds: 5
      readinessProbe:
        exec:
          command:
            - /bin/sh
            - -c
            - echo QUIT\r\n | nc localhost 25
        initialDelaySeconds: 120
        periodSeconds: 5        
    - name: mta-client
      image: ops0-artifactrepo2-0-xrd.slb.sfdc.net/docker-gcp/dva/sfdc-mta-demo:4
      ports:
      - name: http 
        containerPort: 8080
      livenessProbe:
        httpGet:
          path: /
          port: 8080
        timeoutSeconds: 30
        initialDelaySeconds: 120
        periodSeconds: 5
      readinessProbe:
        httpGet:
          path: /
          port: 8080
        timeoutSeconds: 30
        initialDelaySeconds: 120
        periodSeconds: 5
  loadbalancers:
  - lbname: emailinfra-mta-lb
    function: mta
    slbEnabled: true
    ports:
    - lbtype: tcp
      port: 80 
      targetport: 8080
