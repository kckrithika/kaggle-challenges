apiVersion: v1
system:
  functions:
  - name: sam-deployment-portal
    count: 2
    containers:
    - name: sam-deployment-portal
      image: dva/sam/hypersam:2654-906a57b366f0769202f1ddf417b0130b69ac9acc
      command:
      - "/sam/sam-deployment-portal-v2"
      - --port=64123
      - --db-hostname=mysql-inmem-read.sam-system.prd-sam.prd.slb.sfdc.net
      - --db-username=sdpv2
      - --db-password-file=/volumes/sql-dbpass/sdpv2
      - --db-name=sam_kube_resource
      - --v=4
      - --alsologtostderr
      - --web-banner-text=SAM Deployment Portal is currently in Beta. Please give
      - --web-banner-link=https://docs.google.com/forms/d/e/1FAIpQLScvoEhUmQpYfT76s4ABH99HnTJjYmwXUMErqgAjWkcDWSgjVQ/viewform?usp=sf_link
      - --web-banner-link-text=feedback!
      ports:
      - containerPort: 64123
      volumeMounts:
       - mountPath: /volumes/sql-dbpass
         name: mysql
         readOnly: true
      livenessProbe:
        httpGet:
          path: /healthz
          port: 64123
      readinessProbe:
        httpGet:
          path: /healthz
          port: 64123
    volumes:
    - name: mysql
      secret:
        secretName: mysql-passwords
  loadbalancers:
  - lbname: sdp2
    function: sam-deployment-portal
    slbenabled: true
    ports:
      - port: 80
        targetport: 64123
        lbtype: tcp
