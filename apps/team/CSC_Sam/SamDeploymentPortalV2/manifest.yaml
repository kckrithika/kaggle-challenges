apiVersion: v1
system:
  functions:
  - name: sam-deployment-portal
    count: 2
    containers:
    - name: sam-deployment-portal
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/benjamin.caldwell/sam-deployment-portal-v2:20180809_154730.66f4353b.clean.bencald-ltm0
      command:
      - "/sam/sam-deployment-portal-v2"
      - --port=64123
      - --db-hostname=mysql.csc-sam.prd-sam.prd.slb.sfdc.net
      - --db-username=root
      - --db-password-file=/volumes/sql-dbpass/sql-dbpass
      - --db-name=sam_kube_resource
      - --v=4
      - --alsologtostderr
      - --web-banner-text=SAM Deployment Portal is currently in Beta. Please give
      - --web-banner-link=https://docs.google.com/forms/d/e/1FAIpQLScvoEhUmQpYfT76s4ABH99HnTJjYmwXUMErqgAjWkcDWSgjVQ/viewform?usp=sf_link
      - --web-banner-link-text=feedback!
      ports:
      - containerPort: 64123
      volumeMounts:
       - mountPath: /volumes/sql-dbpass
         name: sql-dbpass
         readOnly: true
      livenessProbe:
        httpGet:
          path: /healthz
          port: 64123
      readinessProbe:
        httpGet:
          path: /healthz
          port: 64123
    volumes:
    - name: sql-dbpass
      k4aSecret:
        secretName: sql-dbpass
  loadbalancers:
  - lbname: sdp2
    function: sam-deployment-portal
    slbenabled: true
    ports:
      - port: 80
        targetport: 64123
        lbtype: tcp
