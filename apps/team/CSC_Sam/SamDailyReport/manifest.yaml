apiVersion: v1

system:
  notifications:
    email:
      - sam@salesforce.com
  functions:
  - name: samreport
    count: 1
    containers:
    - name: samreport
      image: dva/sam/hypersam:2704-0055abd26561ebbb6a7b8715a3c7c6a0e14d0feb	
      env:
        - name: TEST
          value: "123"
      command: ["/sam/sam-daily-report"]
      args: ["-missing-host-filter=flowsnake,ip-10-", "-tokenfile", "/var/secrets/git/token.txt", "-argususerfile", "/var/secrets/argus/argus-username", "-arguspasswordfile", "/var/secrets/argus/argus-password", "-smtp-server", "rd1-mta1-4-sfm.ops.sfdc.net:25", "-sender", "sam@salesforce.com", "-default-recipient", "sam@salesforce.com", "-email-hour", "12", "-alsologtostderr"]
      ports:
      - containerPort: 64122
      livenessProbe:
        httpGet:
          path: /probe
          port: 64122
        initialDelaySeconds: 30
      volumeMounts:
        - mountPath: /var/secrets/git
          name: gitvol
          readOnly: true
        - mountPath: /var/secrets/argus
          name: argusvol
          readOnly: true
    volumes:
    - name: argusvol
      k4aSecret:
        secretName: argusk4a
    - name: gitvol
      k4aSecret:
        secretName: git-token
  loadbalancers:
  - lbname: samdrlb
    function: samreport
    slbEnabled: true
    ports:
      - port: 64122
        targetport: 64122
