apiVersion: v1

system:
    notifications:
      email:
        - paul.howden@salesforce.com
        - akouthoofd@salesforce.com
    functions:
    - name: warden-func
      count: 3
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: prod-warden-par
        image: dva/casp/warden_strata:146
        ports:
        - name: warden
          containerPort: 8889
          hostPort: 18889
        - name: grpc
          containerPort: 7442
        env:
        - name: BRANCH
          value: "ops_production"
        - name: JWT_ENABLED
          value: "true"
        volumeMounts:
        - mountPath: /home/sfdc-casp/logs
          name: log-vol
        - mountPath: /home/sfdc-casp/pki/client
          name: maievclientcert
        - mountPath: /home/sfdc-casp/pki/server
          name: wardenservercert
        livenessProbe:
          httpGet:
            path: /manage/health
            port: 15372
          initialDelaySeconds: 60
      volumes:
      - name: log-vol
        hostPath:
          path: /home/sfdc-casp/logs
      - name: maievclientcert
        maddogCert:
          type: client
      - name: wardenservercert
        maddogCert:
          type: server
          lbnames:
          - wardenlb

    loadbalancers:
    - lbname: wardenlb
      function: warden-func
      nodeExposed: true
      ports:
        - port: 8889
          targetport: 8889
        - port: 7442
          targetport: 7442
