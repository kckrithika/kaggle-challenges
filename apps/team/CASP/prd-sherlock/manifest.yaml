apiVersion: v1
system:
  notifications:
    email:
      - aborra@salesforce.com
      - rpothana@salesforce.com
  functions:
  - name: sherlock
    count: 3
    strategy:
      type: Recreate
    containers:
    - name: sherlock
      image: ops0-artifactrepo1-0-prd.data.sfdc.net/docker-sam/aborra/sherlock:rc0-s9d7f
      ports:
      - name: http
        containerPort: 5555
        hostPort: 5555
      env:
        - name: BROKER_URL
          value: 'mycroft.casp.prd-sam.prd.slb.sfdc.net'
        - name: SHARED0_SAMMINIONWARDEN1_1_PRD_KINGDOMS
          value: 'phx,par,lo2,frf,fra'
        - name: SHARED0_SAMMINIONWARDEN1_2_PRD_KINGDOMS
          value: 'iad,ukb,hnd,lo3,chi,wax,yul,cdu,syd,chx,cdg'
        - name: SHARED0_SAMMINIONWARDEN2_1_PRD_KINGDOMS
          value: 'ia2,ord,dfw,ph2'
        - name: MY_SAM_HOST_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
      volumeMounts:
        - mountPath: /opt/sherlock/data
          name: sherlock-data-vol
        - mountPath: /opt/sherlock/logs
          name: sherlock-logs-vol
      livenessProbe:
        exec:
          command:
            - /opt/sherlock/bin/ping.sh
        failureThreshold: 60
        periodSeconds: 10
        timeoutSeconds: 10
        initialDelaySeconds: 10
      resources:
        limits:
          cpu: 16
          memory: 16Gi
        requests:
          cpu: 16
          memory: 16Gi
    volumes:
      - name: sherlock-data-vol
        hostPath:
          path: /data/sherlock
      - name: sherlock-logs-vol
        hostPath:
          path: /data/sherlock-logs

  loadbalancers:
  - lbname: sherlock-flower-lb
    function: sherlock
    slbenabled: true
    ports:
      - port: 80
        targetport: 5555
