apiVersion: v1

system:
    notifications:
      email:
        - paul.howden@salesforce.com
        - pteyer@salesforce.com
    functions:
    - name: warden-func
      count: 1
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: prd-warden
        image: tnrp/casp/warden:0.0.1-0000182-f9433eac
        ports:
        - name: warden
          containerPort: 8889
          hostPort: 18889
        - name: es-es
          containerPort: 9300
          hostPort: 9300
        - name: es-http
          containerPort: 9200
          hostPort: 9200
        env:
        - name: BRANCH
          value: "eng_production"
        volumeMounts:
        - mountPath: /home/sfdc-casp/logs
          name: log-vol
        - mountPath: /home/sfdc-casp/lib/warden/mysql
          name: mysql-vol
        - mountPath: /home/sfdc-casp/elasticsearch/data
          name: es-vol
        livenessProbe:
          httpGet:
            path: /manage/health
            port: 15372
          initialDelaySeconds: 120
      volumes:
      - name: log-vol
        hostPath:
          path: /home/sfdc-casp/logs
      - name: mysql-vol
        hostPath:
          path: /home/sfdc-casp/lib/warden/mysql
      - name: es-vol
        hostPath:
          path: /home/sfdc-casp/elasticsearch/data

    loadbalancers:
    - lbname: warden
      function: warden-func
      slbEnabled: true
      ports:
        - port: 80
          targetport: 8889
        - port: 9200
          targetport: 9200
        - port: 9300
          targetport: 9300
