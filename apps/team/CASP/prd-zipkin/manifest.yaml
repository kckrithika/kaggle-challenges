apiVersion: v1

system:
  notifications:
    email:
      - pteyer@salesforce.com
  functions:
  - name: zipkin-func
    type: stateful-set
    count: 1
    containers:
    - name: zipkin
      image: tnrp/casp/zipkin:0.0.1-0000199-ffd5986f

      volumeMounts:
      - mountPath: /home/sfdc-casp/elasticsearch/data
        name: dbvol

      livenessProbe:
        httpGet:
          path: /zipkin
          port: 8887
        initialDelaySeconds: 60 
        timeoutSeconds: 10

      ports:
      - containerPort: 8887
      - containerPort: 9411 

      resources:
        requests:
          memory: "8Gi"
        limits:
          memory: "12Gi"

    lbname: zipkinlb

    terminationGracePeriodSeconds: 12

    volumeClaimTemplates:
    - name: dbvol
      storageClassName: standard
      storageSizeRequest: 8Gi

  loadbalancers:
  - lbname: zipkin-node
    function: zipkin-func
    nodeExposed: true
    ports:
      - port: 9411
        targetport: 9411
      - port: 8887
        targetport: 8887
  - lbname: zipkin
    function: zipkin-func
    slbEnabled: true
    ports:
      - port: 80
        targetport: 8887
