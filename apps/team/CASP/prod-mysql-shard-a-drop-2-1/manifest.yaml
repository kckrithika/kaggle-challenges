apiVersion: v1

system:
    notifications:
      email:
        - warden@salesforce.com
    functions:
    - name: mysql-func-shard-a
      count: 2
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: prod-mysql-shard-a-drop-2-1
        image: dva/casp/mysql_strata:55
        ports:
        - name: mysql-shard-a
          containerPort: 3306
          hostPort: 7015
        volumeMounts:
        - mountPath: /home/sfdc/mysql/data
          name: mysql-data-vol
        - mountPath: /home/sfdc/mysql/backups
          name: mysql-backups-vol
        - mountPath: /home/sfdc/mysql/logs
          name: mysql-logs-vol
        livenessProbe:
          exec:
            command:
            - /usr/bin/true
        env:
        - name: NODENAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: MYSQL_SHARDS
          value: "shared0-samminionwarden1-1-$KINGDOM.ops.sfdc.net:7015,shared0-samminionwarden1-2-$KINGDOM.ops.sfdc.net:7015"
      volumes:
      - name: mysql-data-vol
        hostPath:
          path: /data/mysql-data/shard-a
      - name: mysql-backups-vol
        hostPath:
          path: /data/mysql-backups/shard-a
      - name: mysql-logs-vol
        hostPath:
          path: /data/mysql-logs/shard-a
