apiVersion: v1

system:
    notifications:
      email:
        - pteyer@salesforce.com
        - dtupper@salesforce.com
    functions:
    - name: cmx-func
      count: 1
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 0
          maxUnavailable: 1
      containers:
      - name: prd-cmx
        image: tnrp/casp/cmx:0.0.1-0000020-50aeb9a2
        ports:
        - name: cmx
          containerPort: 7014
        livenessProbe:
          httpGet:
            path: /tenants
            port: 7014
          initialDelaySeconds: 120
        volumeMounts:
        - mountPath: /opt/cmx
          name: cmx
      volumes:
      - name: cmx
        hostPath:
          path: /home/sfdc-cmx

    loadbalancers:
    - lbname: cmx-node
      function: cmx-func
      nodeExposed: true
      ports:
        - port: 7014
          targetport: 7014
    - lbname: cmx
      function: cmx-func
      slbEnabled: true
      ports:
        - port: 80
          targetport: 7014
