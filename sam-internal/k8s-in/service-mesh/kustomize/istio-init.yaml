apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    manifestctl.sam.data.sfdc.net/swagger: disable
  labels:
    app: istio-init
    istio: init
  name: istio-init-service-account
  namespace: mesh-control-plane
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    manifestctl.sam.data.sfdc.net/swagger: disable
  labels:
    app: istio-init
    istio: init
  name: istio-init-mesh-control-plane
rules:
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - create
  - get
  - list
  - watch
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    manifestctl.sam.data.sfdc.net/swagger: disable
  labels:
    app: istio-init
    istio: init
  name: istio-init-admin-role-binding-mesh-control-plane
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: istio-init-mesh-control-plane
subjects:
- kind: ServiceAccount
  name: istio-init-service-account
  namespace: mesh-control-plane
---
apiVersion: v1
data:
  crd-all.gen.yaml: |-
    # DO NOT EDIT - Generated by Cue OpenAPI generator.
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: mixer
        chart: istio
        heritage: Tiller
        istio: core
        package: istio.io.mixer
        release: istio
      name: attributemanifests.config.istio.io
    spec:
      group: config.istio.io
      names:
        categories:
        - istio-io
        - policy-istio-io
        kind: attributemanifest
        plural: attributemanifests
        singular: attributemanifest
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
      - name: v1alpha2
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        heritage: Tiller
        istio: security
        release: istio
      name: authorizationpolicies.security.istio.io
    spec:
      group: security.istio.io
      names:
        categories:
        - istio-io
        - security-istio-io
        kind: AuthorizationPolicy
        plural: authorizationpolicies
        singular: authorizationpolicy
      scope: Namespaced
      subresources:
        status: {}
      version: "v1beta1"
      versions:
      - name: v1beta1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        heritage: Tiller
        istio: rbac
        release: istio
      name: clusterrbacconfigs.rbac.istio.io
    spec:
      group: rbac.istio.io
      names:
        categories:
        - istio-io
        - rbac-istio-io
        kind: ClusterRbacConfig
        plural: clusterrbacconfigs
        singular: clusterrbacconfig
      scope: Cluster
      subresources:
        status: {}
      version: "v1alpha1"
      versions:
      - name: v1alpha1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        chart: istio
        heritage: Tiller
        release: istio
      name: destinationrules.networking.istio.io
    spec:
      additionalPrinterColumns:
      - JSONPath: .spec.host
        description: The name of a service from the service registry
        name: Host
        type: string
      - JSONPath: .metadata.creationTimestamp
        description: |-
          CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
          Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
        name: Age
        type: date
      group: networking.istio.io
      names:
        categories:
        - istio-io
        - networking-istio-io
        kind: DestinationRule
        listKind: DestinationRuleList
        plural: destinationrules
        shortNames:
        - dr
        singular: destinationrule
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha3"
      versions:
      - name: v1alpha3
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        chart: istio
        heritage: Tiller
        release: istio
      name: envoyfilters.networking.istio.io
    spec:
      group: networking.istio.io
      names:
        categories:
        - istio-io
        - networking-istio-io
        kind: EnvoyFilter
        plural: envoyfilters
        singular: envoyfilter
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha3"
      versions:
      - name: v1alpha3
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        chart: istio
        heritage: Tiller
        release: istio
      name: gateways.networking.istio.io
    spec:
      group: networking.istio.io
      names:
        categories:
        - istio-io
        - networking-istio-io
        kind: Gateway
        plural: gateways
        shortNames:
        - gw
        singular: gateway
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha3"
      versions:
      - name: v1alpha3
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-mixer
        chart: istio
        heritage: Tiller
        release: istio
      name: httpapispecbindings.config.istio.io
    spec:
      group: config.istio.io
      names:
        categories:
        - istio-io
        - apim-istio-io
        kind: HTTPAPISpecBinding
        plural: httpapispecbindings
        singular: httpapispecbinding
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
      - name: v1alpha2
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-mixer
        chart: istio
        heritage: Tiller
        release: istio
      name: httpapispecs.config.istio.io
    spec:
      group: config.istio.io
      names:
        categories:
        - istio-io
        - apim-istio-io
        kind: HTTPAPISpec
        plural: httpapispecs
        singular: httpapispec
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
      - name: v1alpha2
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-citadel
        chart: istio
        heritage: Tiller
        release: istio
      name: meshpolicies.authentication.istio.io
    spec:
      group: authentication.istio.io
      names:
        categories:
        - istio-io
        - authentication-istio-io
        kind: MeshPolicy
        listKind: MeshPolicyList
        plural: meshpolicies
        singular: meshpolicy
      scope: Cluster
      subresources:
        status: {}
      version: "v1alpha1"
      versions:
      - name: v1alpha1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-citadel
        chart: istio
        heritage: Tiller
        release: istio
      name: policies.authentication.istio.io
    spec:
      group: authentication.istio.io
      names:
        categories:
        - istio-io
        - authentication-istio-io
        kind: Policy
        plural: policies
        singular: policy
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha1"
      versions:
      - name: v1alpha1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-mixer
        chart: istio
        heritage: Tiller
        release: istio
      name: quotaspecbindings.config.istio.io
    spec:
      group: config.istio.io
      names:
        categories:
        - istio-io
        - apim-istio-io
        kind: QuotaSpecBinding
        plural: quotaspecbindings
        singular: quotaspecbinding
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
      - name: v1alpha2
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-mixer
        chart: istio
        heritage: Tiller
        release: istio
      name: quotaspecs.config.istio.io
    spec:
      group: config.istio.io
      names:
        categories:
        - istio-io
        - apim-istio-io
        kind: QuotaSpec
        plural: quotaspecs
        singular: quotaspec
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
      - name: v1alpha2
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: mixer
        chart: istio
        heritage: Tiller
        istio: rbac
        package: istio.io.mixer
        release: istio
      name: rbacconfigs.rbac.istio.io
    spec:
      group: rbac.istio.io
      names:
        categories:
        - istio-io
        - rbac-istio-io
        kind: RbacConfig
        plural: rbacconfigs
        singular: rbacconfig
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha1"
      versions:
      - name: v1alpha1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: mixer
        chart: istio
        heritage: Tiller
        istio: core
        package: istio.io.mixer
        release: istio
      name: rules.config.istio.io
    spec:
      group: config.istio.io
      names:
        categories:
        - istio-io
        - policy-istio-io
        kind: rule
        plural: rules
        singular: rule
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
      - name: v1alpha2
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        chart: istio
        heritage: Tiller
        release: istio
      name: serviceentries.networking.istio.io
    spec:
      additionalPrinterColumns:
      - JSONPath: .spec.hosts
        description: The hosts associated with the ServiceEntry
        name: Hosts
        type: string
      - JSONPath: .spec.location
        description: Whether the service is external to the mesh or part of the mesh (MESH_EXTERNAL
          or MESH_INTERNAL)
        name: Location
        type: string
      - JSONPath: .spec.resolution
        description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
        name: Resolution
        type: string
      - JSONPath: .metadata.creationTimestamp
        description: |-
          CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
          Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
        name: Age
        type: date
      group: networking.istio.io
      names:
        categories:
        - istio-io
        - networking-istio-io
        kind: ServiceEntry
        listKind: ServiceEntryList
        plural: serviceentries
        shortNames:
        - se
        singular: serviceentry
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha3"
      versions:
      - name: v1alpha3
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: mixer
        chart: istio
        heritage: Tiller
        istio: rbac
        package: istio.io.mixer
        release: istio
      name: servicerolebindings.rbac.istio.io
    spec:
      additionalPrinterColumns:
      - JSONPath: .spec.roleRef.name
        description: The name of the ServiceRole object being referenced
        name: Reference
        type: string
      - JSONPath: .metadata.creationTimestamp
        description: |-
          CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
          Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
        name: Age
        type: date
      group: rbac.istio.io
      names:
        categories:
        - istio-io
        - rbac-istio-io
        kind: ServiceRoleBinding
        plural: servicerolebindings
        singular: servicerolebinding
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha1"
      versions:
      - name: v1alpha1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: mixer
        chart: istio
        heritage: Tiller
        istio: rbac
        package: istio.io.mixer
        release: istio
      name: serviceroles.rbac.istio.io
    spec:
      group: rbac.istio.io
      names:
        categories:
        - istio-io
        - rbac-istio-io
        kind: ServiceRole
        plural: serviceroles
        singular: servicerole
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha1"
      versions:
      - name: v1alpha1
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        chart: istio
        heritage: Tiller
        release: istio
      name: sidecars.networking.istio.io
    spec:
      group: networking.istio.io
      names:
        categories:
        - istio-io
        - networking-istio-io
        kind: Sidecar
        plural: sidecars
        singular: sidecar
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha3"
      versions:
      - name: v1alpha3
        served: true
        storage: true

    ---
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      annotations:
        "helm.sh/resource-policy": keep
      creationTimestamp: null
      labels:
        app: istio-pilot
        chart: istio
        heritage: Tiller
        release: istio
      name: virtualservices.networking.istio.io
    spec:
      additionalPrinterColumns:
      - JSONPath: .spec.gateways
        description: The names of gateways and sidecars that should apply these routes
        name: Gateways
        type: string
      - JSONPath: .spec.hosts
        description: The destination hosts to which traffic is being sent
        name: Hosts
        type: string
      - JSONPath: .metadata.creationTimestamp
        description: |-
          CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is represented in RFC3339 form and is in UTC.
          Populated by the system. Read-only. Null for lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata
        name: Age
        type: date
      group: networking.istio.io
      names:
        categories:
        - istio-io
        - networking-istio-io
        kind: VirtualService
        listKind: VirtualServiceList
        plural: virtualservices
        shortNames:
        - vs
        singular: virtualservice
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha3"
      versions:
      - name: v1alpha3
        served: true
        storage: true

    ---
kind: ConfigMap
metadata:
  name: istio-crd-all
  namespace: mesh-control-plane
---
apiVersion: v1
data:
  crd-mixer.yaml: |-
    kind: CustomResourceDefinition
    apiVersion: apiextensions.k8s.io/v1beta1
    metadata:
      name: adapters.config.istio.io
      labels:
        app: mixer
        package: adapter
        istio: mixer-adapter
        chart: istio
        heritage: Tiller
        release: istio
      annotations:
        "helm.sh/resource-policy": keep
    spec:
      group: config.istio.io
      names:
        kind: adapter
        plural: adapters
        singular: adapter
        categories:
        - istio-io
        - policy-istio-io
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
        - name: v1alpha2
          served: true
          storage: true
    ---
    kind: CustomResourceDefinition
    apiVersion: apiextensions.k8s.io/v1beta1
    metadata:
      name: instances.config.istio.io
      labels:
        app: mixer
        package: instance
        istio: mixer-instance
        chart: istio
        heritage: Tiller
        release: istio
      annotations:
        "helm.sh/resource-policy": keep
    spec:
      group: config.istio.io
      names:
        kind: instance
        plural: instances
        singular: instance
        categories:
        - istio-io
        - policy-istio-io
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
        - name: v1alpha2
          served: true
          storage: true
    ---
    kind: CustomResourceDefinition
    apiVersion: apiextensions.k8s.io/v1beta1
    metadata:
      name: templates.config.istio.io
      labels:
        app: mixer
        package: template
        istio: mixer-template
        chart: istio
        heritage: Tiller
        release: istio
      annotations:
        "helm.sh/resource-policy": keep
    spec:
      group: config.istio.io
      names:
        kind: template
        plural: templates
        singular: template
        categories:
        - istio-io
        - policy-istio-io
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
        - name: v1alpha2
          served: true
          storage: true
    ---
    kind: CustomResourceDefinition
    apiVersion: apiextensions.k8s.io/v1beta1
    metadata:
      name: handlers.config.istio.io
      labels:
        app: mixer
        package: handler
        istio: mixer-handler
        chart: istio
        heritage: Tiller
        release: istio
      annotations:
        "helm.sh/resource-policy": keep
    spec:
      group: config.istio.io
      names:
        kind: handler
        plural: handlers
        singular: handler
        categories:
        - istio-io
        - policy-istio-io
      scope: Namespaced
      subresources:
        status: {}
      version: "v1alpha2"
      versions:
        - name: v1alpha2
          served: true
          storage: true
    ---
kind: ConfigMap
metadata:
  name: istio-crd-mixer
  namespace: mesh-control-plane
---
apiVersion: batch/v1
kind: Job
metadata:
  name: istio-init-crd-all-68662a54f8059519f73429ae251595e2
  namespace: mesh-control-plane
spec:
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
      labels: null
    spec:
      automountServiceAccountToken: true
      containers:
      - command:
        - kubectl
        - apply
        - -f
        - /etc/istio/crd-all/crd-all.gen.yaml
        image: '%(istioHub)s/kubectl:%(istioTag)s'
        imagePullPolicy: Always
        name: istio-init-crd-all
        resources:
          limits:
            cpu: 100m
            memory: 200Mi
          requests:
            cpu: 10m
            memory: 50Mi
        volumeMounts:
        - mountPath: /etc/istio/crd-all
          name: crd-all
          readOnly: true
      nodeSelector:
        pool: mcpIstioConfig.istioEstate
      restartPolicy: OnFailure
      securityContext:
        fsGroup: 7447
        runAsNonRoot: true
        runAsUser: 7447
      serviceAccountName: istio-init-service-account
      volumes:
      - configMap:
          name: istio-crd-all
        name: crd-all
---
apiVersion: batch/v1
kind: Job
metadata:
  name: istio-init-crd-mixer-68662a54f8059519f73429ae251595e2
  namespace: mesh-control-plane
spec:
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
      labels: null
    spec:
      automountServiceAccountToken: true
      containers:
      - command:
        - kubectl
        - apply
        - -f
        - /etc/istio/crd-mixer/crd-mixer.yaml
        image: '%(istioHub)s/kubectl:%(istioTag)s'
        imagePullPolicy: Always
        name: istio-init-crd-mixer
        resources:
          limits:
            cpu: 100m
            memory: 200Mi
          requests:
            cpu: 10m
            memory: 50Mi
        volumeMounts:
        - mountPath: /etc/istio/crd-mixer
          name: crd-mixer
          readOnly: true
      nodeSelector:
        pool: mcpIstioConfig.istioEstate
      restartPolicy: OnFailure
      securityContext:
        fsGroup: 7447
        runAsNonRoot: true
        runAsUser: 7447
      serviceAccountName: istio-init-service-account
      volumes:
      - configMap:
          name: istio-crd-mixer
        name: crd-mixer
