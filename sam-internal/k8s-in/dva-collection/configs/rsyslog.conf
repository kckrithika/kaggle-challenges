global (
  workdirectory = "/var/spool/rsyslog"
  maxMessageSize = "900k"
)

module(load = "imfile")
module(load = "omkafka")
module(load = "omprog")
module(load = "mmexternal")
module(load = "mmjsonparse")
module(load = "omstdout")
module(load = "impstats"
       interval="120"
       severity="7"
       ruleset="ruleset_stdout")

ruleset(name="ruleset_impstats") {
  call ruleset_stdout
  action(type="omprog"
       name="pki_mointor"
       binary="/usr/local/bin/pki_cert_monitor.py /etc/pki_service/root/rsyslog_agent"
       queue.type="LinkedList"
       queue.saveOnShutdown="off"
       queue.workerThreads="1"
       action.execOnlyOnceEveryInterval="1800"
       action.resumeInterval="5"
       killUnresponsive="on"
       forceSingleInstance="on")
}

ruleset(name="ruleset_stdout") {  
  action(type="omstdout")
}

$IncludeConfig /etc/rsyslog.d/*.conf