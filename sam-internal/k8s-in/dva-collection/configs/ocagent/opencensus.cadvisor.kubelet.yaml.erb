receivers:
    prometheus:
        config:
            global:
                scrape_interval: 120s
                scrape_timeout: 8s
            scrape_configs:
            - job_name: 'cadvisor'
              scrape_interval: 120s
              metrics_path: /metrics/cadvisor
              static_configs:
              - targets: ['<%=config.node%>:10255']
              metric_relabel_configs:
              # Whitelist metrics. Only keep metrics that match this regex.
              - source_labels: [ __name__ ]
                regex: '.*cpu_cfs.*|.*cpu_schedstat.*|.*cpu_system.*|.*cpu_usage.*|.*cpu_user.*|.*file.*|.*fs_inodes.*|.*fs_io.*|.*fs_limit.*|.*fs_read.*|.*fs_usage.*|.*fs_write.*|.*last_seen.*|.*memory.*|.*network_receive.*|.*network_transmit.*|.*processes.*|.*spec.*|.*start_time.*|.*tasks.*'
                action: keep
              # Rename and clean labels.
              # Grab the few container label values we care about.
              - source_labels: [container_name]
                target_label: 'k8s_container_name'
              - source_labels: [pod_name]
                target_label: 'k8s_pod_name'
              - source_labels: [namespace]
                target_label: 'k8s_namespace'
              - source_labels: [device]
                target_label: 'dev'
              # Drop original labels.
              - regex: 'pod_name|container_name|namespace'
                action: labeldrop
              # And drop the rest of them.
              - regex: '(container_label.*)'
                action: labeldrop
              # Drop id="/kubepods/burstable/pod438feba1-5fdb-...".
              - regex: '(id)'
                action: labeldrop
              # Drop name="k8s_cadvisor_cadvisor-9s64c_default_438feba1-...".
              - regex: '(name)'
                action: labeldrop
              # Drop image label.
              - regex: '(image)'
                action: labeldrop
              - regex: '(device)'
                action: labeldrop
              # Drop metrics with empty container, pod, or namespace fields.
              # These are other system slices/cgroups, not containers.
              - source_labels: [k8s_container_name]
                regex: '^$'
                action: drop
              - source_labels: [k8s_pod_name]
                regex: '^$'
                action: drop
              - source_labels: [k8s_namespace]
                regex: '^$'
                action: drop

exporters:
    funnel:
        host: "ajnafunneldirecttls.funnel.localhost.mesh.force.com"
        port: 5442
        #enable_mtls: true
        #pki_service_name: "client"
        #pki_root_path: /certs
        #pki_repo_dir_path: /certs/client
        gzip: true
        labels:
            k8s_cluster: <%=config.cluster%>
            device: <%=config.node%>
            substrate: <%=config.substrate%>
            account: <%=config.account_name%>
            region: <%=config.region%>
            zone: <%=config.zone%>
            datacenter: <%=config.kingdom%>
            superpod: '-'
            pod: '-'

    prometheus:
        namespace: "debug"
        address: "localhost:8899"

zpages:
    port: 55679