apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    name: samsqlreporter
    sam.data.sfdc.net/owner: sam
  name: samsqlreporter
  namespace: sam-system
spec:
  replicas: 2
  selector:
    matchLabels:
      name: samsqlreporter
  template:
    metadata:
      labels:
        apptype: control
        name: samsqlreporter
        sam.data.sfdc.net/owner: sam
    spec:
      containers:
      - args:
        - --dbPasswordFile=/var/secrets/reporter
        - -v=5
        - --alsologtostderr
        - --port=64212
        - --queryFile=/var/queries/sam-sql-queries.json
        - --dbHostname=mysql-inmem-service.sam-system.prd-sam.prd.slb.sfdc.net
        - --dbUsername=reporter
        command:
        - /sam/sam-sql-reporter
        image: ops0-artifactrepo2-0-prd.data.sfdc.net/docker-dva-rc/dva/sam/hypersam:2806-21b02aaa76e1150dcbe5caceb5e06e03a64c7d43
        livenessProbe:
          httpGet:
            path: /
            port: 64212
        name: samsqlreporter
        ports:
        - containerPort: 64212
          protocol: TCP
        resources:
          limits:
            sam.sfdc.net/ip-address: "1"
          requests:
            sam.sfdc.net/ip-address: "1"
        volumeMounts:
        - mountPath: /var/secrets/
          name: mysql
          readOnly: true
        - mountPath: /var/queries/
          name: queries
          readOnly: true
      nodeSelector:
        pool: prd-sam
      volumes:
      - name: mysql
        secret:
          secretName: mysql-passwords
      - configMap:
          name: samsqlqueries
        name: queries
