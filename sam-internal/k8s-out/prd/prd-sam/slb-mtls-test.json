{
   "apiVersion": "extensions/v1beta1",
   "kind": "Deployment",
   "metadata": {
      "labels": {
         "name": "slb-mtls-test"
      },
      "name": "slb-mtls-test",
      "namespace": "sam-system"
   },
   "spec": {
      "replicas": 1,
      "template": {
         "metadata": {
            "annotations": {
               "madkub.sam.sfdc.net/allcerts": "{\n            \"certreqs\":[\n                {\n                    \"name\": \"cert1\",\n                    \"cert-type\":\"server\",\n                    \"kingdom\":\"prd\",\n                    \"role\": \"sam_compute\",\n                    \"san\":[\n                        \"*.sam-system.prd-sam.prd.slb.sfdc.net\"\n                    ]\n                },\n                {\n                    \"name\": \"cert2\",\n                    \"cert-type\":\"client\",\n                    \"kingdom\":\"prd\",\n                    \"role\": \"sam_compute\"\n                }\n            ]\n         }"
            },
            "creationTimestamp": null,
            "labels": {
               "name": "slb-mtls-test"
            },
            "namespace": "sam-system"
         },
         "spec": {
            "containers": [
               {
                  "args": [
                     "/sam/madkub-client",
                     "--madkub-endpoint",
                     "https://$(MADKUBSERVER_SERVICE_HOST):32007",
                     "--maddog-endpoint",
                     "https://all.pkicontroller.pki.blank.prd.prod.non-estates.sfdcsd.net:8443",
                     "--maddog-server-ca",
                     "/maddog-certs/ca/security-ca.pem",
                     "--madkub-server-ca",
                     "/maddog-certs/ca/cacerts.pem",
                     "--cert-folders",
                     "cert1:/cert1/",
                     "--cert-folders",
                     "cert2:/cert2/",
                     "--token-folder",
                     "/tokens/",
                     "--requested-cert-type",
                     "client",
                     "--refresher"
                  ],
                  "env": [
                     {
                        "name": "MADKUB_NODENAME",
                        "valueFrom": {
                           "fieldRef": {
                              "fieldPath": "spec.nodeName"
                           }
                        }
                     },
                     {
                        "name": "MADKUB_NAME",
                        "valueFrom": {
                           "fieldRef": {
                              "fieldPath": "metadata.name"
                           }
                        }
                     },
                     {
                        "name": "MADKUB_NAMESPACE",
                        "valueFrom": {
                           "fieldRef": {
                              "fieldPath": "metadata.namespace"
                           }
                        }
                     }
                  ],
                  "image": "ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sam/madkub:1.0.0-0000066-fedd8bce",
                  "name": "madkub-refresher",
                  "resources": { },
                  "volumeMounts": [
                     {
                        "mountPath": "/cert1",
                        "name": "cert1"
                     },
                     {
                        "mountPath": "/cert2",
                        "name": "cert2"
                     },
                     {
                        "mountPath": "/tokens",
                        "name": "tokens"
                     },
                     {
                        "mountPath": "/maddog-certs/",
                        "name": "maddog-certs"
                     }
                  ]
               }
            ],
            "hostNetwork": true,
            "nodeSelector": {
               "pool": "prd-sam"
            },
            "restartPolicy": "Always",
            "volumes": [
               {
                  "hostPath": {
                     "path": "/data/slb/logs"
                  },
                  "name": "var-logs-volume"
               },
               {
                  "hostPath": {
                     "path": "/data/slb/nginx/config"
                  },
                  "name": "var-target-config-volume"
               },
               {
                  "emptyDir": {
                     "medium": "Memory"
                  },
                  "name": "cert1"
               },
               {
                  "emptyDir": {
                     "medium": "Memory"
                  },
                  "name": "cert2"
               },
               {
                  "emptyDir": {
                     "medium": "Memory"
                  },
                  "name": "tokens"
               },
               {
                  "hostPath": {
                     "path": "/etc/pki_service"
                  },
                  "name": "maddog-certs"
               },
               {
                  "configMap": {
                     "name": "sfdchosts"
                  },
                  "name": "sfdchosts"
               }
            ]
         }
      }
   }
}
