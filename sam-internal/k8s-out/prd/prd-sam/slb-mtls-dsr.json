{
   "apiVersion": "extensions/v1beta1",
   "kind": "Deployment",
   "metadata": {
      "creationTimestamp": null,
      "labels": {
         "name": "slb-mtls-dsr"
      },
      "name": "slb-mtls-dsr",
      "namespace": "sam-system"
   },
   "spec": {
      "minReadySeconds": 30,
      "replicas": 1,
      "strategy": {
         "type": "RollingUpdate"
      },
      "template": {
         "metadata": {
            "annotations": {
               "madkub.sam.sfdc.net/allcerts": "{\n            \"certreqs\":[\n                {\n                    \"name\": \"cert1\",\n                    \"cert-type\":\"server\",\n                    \"kingdom\":\"prd\",\n                    \"role\": \"sam_compute\",\n                    \"san\":[\n                        \"*.sam-system.prd-sam.prd.slb.sfdc.net\"\n                    ]\n                },\n                {\n                    \"name\": \"cert2\",\n                    \"cert-type\":\"client\",\n                    \"kingdom\":\"prd\",\n                    \"role\": \"sam_compute\"\n                }\n            ]\n         }",
               "pod.beta.kubernetes.io/init-containers": "[\n            {\n              \"image\": \"ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sam/madkub:1.0.0-0000066-fedd8bce\",\n              \"args\": [\n                \"/sam/madkub-client\",\n                \"--madkub-endpoint\",\n                \"https://$(MADKUBSERVER_SERVICE_HOST):32007\",\n                \"--maddog-endpoint\",\n                \"https://all.pkicontroller.pki.blank.prd.prod.non-estates.sfdcsd.net:8443\",\n                \"--maddog-server-ca\",\n                \"/maddog-certs/ca/security-ca.pem\",\n                \"--madkub-server-ca\",\n                \"/maddog-certs/ca/cacerts.pem\",\n                \"--cert-folders\",\n                \"cert1:/cert1/\",\n                \"--cert-folders\",\n                \"cert2:/cert2/\",\n                \"--token-folder\",\n                \"/tokens/\",\n                \"--requested-cert-type\",\n                \"client\"\n              ],\n              \"name\": \"madkub-init\",\n              \"imagePullPolicy\": \"IfNotPresent\",\n              \"volumeMounts\": [\n                {\n                    \"mountPath\": \"/cert1\",\n                    \"name\": \"cert1\"\n                },\n                {\n                    \"mountPath\": \"/cert2\",\n                    \"name\": \"cert2\"\n                },\n                {\n                    \"mountPath\": \"/maddog-certs/\",\n                    \"name\": \"maddog-certs\"\n                },\n                {\n                    \"mountPath\": \"/tokens\",\n                    \"name\": \"tokens\"\n                }\n              ],\n              \"env\": [\n                {\n                    \"name\": \"MADKUB_NODENAME\",\n                    \"valueFrom\":\n                    {\n                        \"fieldRef\":{\"fieldPath\": \"spec.nodeName\", \"apiVersion\": \"v1\"}\n                    }\n                },\n                {\n                    \"name\": \"MADKUB_NAME\",\n                    \"valueFrom\":\n                    {\n                        \"fieldRef\":{\"fieldPath\": \"metadata.name\", \"apiVersion\": \"v1\"}\n                    }\n                },\n                {\n                    \"name\": \"MADKUB_NAMESPACE\",\n                    \"valueFrom\":\n                    {\n                        \"fieldRef\":{\"fieldPath\": \"metadata.namespace\", \"apiVersion\": \"v1\"}\n                    }\n                }\n              ]\n            }\n         ]"
            },
            "creationTimestamp": null,
            "labels": {
               "name": "slb-mtls-dsr"
            },
            "namespace": "sam-system"
         },
         "spec": {
            "containers": [
               {
                  "command": [
                     "/runner.sh"
                  ],
                  "image": "ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sdn/slb-nginx:v-0000024-6c678838",
                  "livenessProbe": {
                     "httpGet": {
                        "path": "/",
                        "port": 12080
                     },
                     "initialDelaySeconds": 15,
                     "periodSeconds": 10
                  },
                  "name": "slb-mtls-dsr",
                  "volumeMounts": [
                     {
                        "mountPath": "/etc/nginx/conf.d",
                        "name": "var-target-config-volume"
                     },
                     {
                        "mountPath": "/host/data/slb/logs",
                        "name": "var-logs-volume"
                     },
                     {
                        "mountPath": "/cert1",
                        "name": "cert1"
                     },
                     {
                        "mountPath": "/cert2",
                        "name": "cert2"
                     }
                  ]
               },
               {
                  "command": [
                     "/sdn/slb-file-watcher",
                     "--filePath=/host/data/slb/logs/slb-nginx-proxy.emerg.log",
                     "--metricName=nginx-emergency",
                     "--lastModReportTime=120s",
                     "--scanPeriod=10s",
                     "--skipZeroLengthFiles=true",
                     "--metricsEndpoint=ajna0-funnel1-0-prd.data.sfdc.net:80",
                     "--log_dir=/host/data/slb/logs",
                     "--hostsConfigFile=/sfdchosts/hosts.json"
                  ],
                  "image": "ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sdn/hypersdn:v-0000693-e1dfadf7",
                  "name": "slb-file-watcher",
                  "volumeMounts": [
                     {
                        "mountPath": "/etc/nginx/conf.d",
                        "name": "var-target-config-volume"
                     },
                     {
                        "mountPath": "/host/data/slb/logs",
                        "name": "var-logs-volume"
                     },
                     {
                        "mountPath": "/sfdchosts",
                        "name": "sfdchosts"
                     }
                  ]
               },
               {
                  "args": [
                     "/sam/madkub-client",
                     "--madkub-endpoint",
                     "https://$(MADKUBSERVER_SERVICE_HOST):32007",
                     "--maddog-endpoint",
                     "https://all.pkicontroller.pki.blank.prd.prod.non-estates.sfdcsd.net:8443",
                     "--maddog-server-ca",
                     "/maddog-certs/ca/security-ca.pem",
                     "--madkub-server-ca",
                     "/maddog-certs/ca/cacerts.pem",
                     "--cert-folders",
                     "cert1:/cert1/",
                     "--cert-folders",
                     "cert2:/cert2/",
                     "--token-folder",
                     "/tokens/",
                     "--requested-cert-type",
                     "client",
                     "--refresher"
                  ],
                  "env": [
                     {
                        "name": "MADKUB_NODENAME",
                        "valueFrom": {
                           "fieldRef": {
                              "fieldPath": "spec.nodeName"
                           }
                        }
                     },
                     {
                        "name": "MADKUB_NAME",
                        "valueFrom": {
                           "fieldRef": {
                              "fieldPath": "metadata.name"
                           }
                        }
                     },
                     {
                        "name": "MADKUB_NAMESPACE",
                        "valueFrom": {
                           "fieldRef": {
                              "fieldPath": "metadata.namespace"
                           }
                        }
                     }
                  ],
                  "image": "ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sam/madkub:1.0.0-0000066-fedd8bce",
                  "name": "madkub-refresher",
                  "resources": { },
                  "volumeMounts": [
                     {
                        "mountPath": "/cert1",
                        "name": "cert1"
                     },
                     {
                        "mountPath": "/cert2",
                        "name": "cert2"
                     },
                     {
                        "mountPath": "/tokens",
                        "name": "tokens"
                     },
                     {
                        "mountPath": "/maddog-certs/",
                        "name": "maddog-certs"
                     }
                  ]
               }
            ],
            "hostNetwork": true,
            "nodeSelector": {
               "pool": "prd-sam"
            },
            "restartPolicy": "Always",
            "volumes": [
               {
                  "hostPath": {
                     "path": "/data/slb/logs"
                  },
                  "name": "var-logs-volume"
               },
               {
                  "hostPath": {
                     "path": "/data/slb/nginx/config"
                  },
                  "name": "var-target-config-volume"
               },
               {
                  "emptyDir": {
                     "medium": "Memory"
                  },
                  "name": "cert1"
               },
               {
                  "emptyDir": {
                     "medium": "Memory"
                  },
                  "name": "cert2"
               },
               {
                  "emptyDir": {
                     "medium": "Memory"
                  },
                  "name": "tokens"
               },
               {
                  "hostPath": {
                     "path": "/etc/pki_service"
                  },
                  "name": "maddog-certs"
               },
               {
                  "configMap": {
                     "name": "sfdchosts"
                  },
                  "name": "sfdchosts"
               }
            ]
         }
      }
   }
}
