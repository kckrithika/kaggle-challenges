apiVersion: v1
items:
- apiVersion: v1
  kind: Service
  metadata:
    labels:
      app: firefly-crawler
      sam.data.sfdc.net/owner: tnrp
    name: firefly-crawler-service
    namespace: firefly
  spec:
    ports:
    - name: admin-port
      nodePort: 32085
      port: 8081
      protocol: TCP
      targetPort: 8081
    selector:
      name: firefly-crawler
    type: LoadBalancer
- apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    labels:
      name: firefly-crawler
      sam.data.sfdc.net/owner: tnrp
    name: firefly-crawler-deployment
    namespace: firefly
  spec:
    replicas: 1
    strategy:
      rollingUpdate:
        maxSurge: 0
        maxUnavailable: 1
      type: RollingUpdate
    template:
      metadata:
        annotations:
          madkub.sam.sfdc.net/allcerts: '{"certreqs":[{"name": "certs","san":["firefly"],"cert-type":"client",
            "kingdom":"prd", "role": "firefly"}]}'
        labels:
          name: firefly-crawler
          sam.data.sfdc.net/owner: tnrp
        name: firefly-crawler-deployment
        namespace: firefly
      spec:
        containers:
        - args:
          - /sam/madkub-client
          - --madkub-endpoint
          - https://10.254.208.254:32007
          - --maddog-endpoint
          - https://all.pkicontroller.pki.blank.prd.prod.non-estates.sfdcsd.net:8443
          - --maddog-server-ca
          - /maddog-certs/ca/security-ca.pem
          - --madkub-server-ca
          - /maddog-certs/ca/cacerts.pem
          - --cert-folders
          - certs:/certs/
          - --token-folder
          - /tokens/
          - --requested-cert-type
          - client
          - --refresher
          - --run-init-for-refresher-mode
          - --ca-folder
          - /maddog-certs/ca
          env:
          - name: MADKUB_NODENAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: MADKUB_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: MADKUB_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          image: ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sam/madkub:1.0.0-0000074-4c95976a
          name: madkub-refresher
          resources: {}
          volumeMounts:
          - mountPath: /certs
            name: certs
          - mountPath: /tokens
            name: tokens
          - mountPath: /maddog-certs/
            name: maddog-certs
        - command:
          - java
          - -jar
          - /crawler-svc.jar
          - --spring.profiles.active=prd-samtwo
          env:
          - name: exchangeName
            value: firefly.delivery
          - name: DOCKER_HOST
            value: http://localhost:2375
          - name: rootDir
            value: /tmp
          - name: dockerCertPath
            value: /etc/docker/certs.d
          - name: rabbitMqEndpoint
            value: shared0-samtwokubeapi1-1-prd.eng.sfdc.net
          - name: rabbitMqPort
            value: "33672"
          - name: rabbitMqUserName
            value: sfdc-rabbitmq
          - name: artifactoryDevHost
            value: ops0-artifactrepo1-0-prd.data.sfdc.net
          - name: artifactoryP2PHost
            value: ops0-artifactrepo2-0-prd.data.sfdc.net
          - name: artifactoryUserName
            value: svc_tnrp_artifactory
          - name: artifactoryContentRepoUserName
            value: svc_tnrp_ci
          - name: artifactoryContentRepoUserNameProd
            value: svc_tnrp_cd
          - name: KINGDOM
            value: prd
          - name: SUPERPOD
            value: none
          - name: FUNCTION_INSTANCE_NAME
            value: firefly-crawler
          - name: MY_NODE_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: spec.nodeName
          - name: MY_POD_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.name
          - name: MY_POD_IP
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: status.podIP
          image: ops0-artifactrepo2-0-prd.data.sfdc.net/dva/firefly-crawler:89
          imagePullPolicy: Always
          name: firefly-crawler
          ports:
          - containerPort: 8081
            name: admin-port
            protocol: TCP
          volumeMounts:
          - mountPath: /certs
            name: certs
          - mountPath: /root/.ssh/
            name: git-ssh-keys
        initContainers:
        - args:
          - /sam/madkub-client
          - --madkub-endpoint
          - https://10.254.208.254:32007
          - --maddog-endpoint
          - https://all.pkicontroller.pki.blank.prd.prod.non-estates.sfdcsd.net:8443
          - --maddog-server-ca
          - /maddog-certs/ca/security-ca.pem
          - --madkub-server-ca
          - /maddog-certs/ca/cacerts.pem
          - --cert-folders
          - certs:/certs/
          - --token-folder
          - /tokens/
          - --requested-cert-type
          - client
          - --ca-folder
          - /maddog-certs/ca
          env:
          - name: MADKUB_NODENAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: spec.nodeName
          - name: MADKUB_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.name
          - name: MADKUB_NAMESPACE
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
          image: ops0-artifactrepo2-0-prd.data.sfdc.net/docker-release-candidate/tnrp/sam/madkub:1.0.0-0000074-4c95976a
          imagePullPolicy: IfNotPresent
          name: madkub-init
          volumeMounts:
          - mountPath: /certs
            name: certs
          - mountPath: /maddog-certs/
            name: maddog-certs
          - mountPath: /tokens
            name: tokens
        nodeSelector:
          pool: prd-sam_tnrp_signer
        terminationGracePeriodSeconds: 10
        volumes:
        - emptyDir: {}
          name: docker-graph-storage
        - emptyDir: {}
          name: docker-build-dir
        - emptyDir:
            medium: Memory
          name: tokens
        - emptyDir:
            medium: Memory
          name: certs
        - emptyDir:
            medium: Memory
          name: git-ssh-keys
        - hostPath:
            path: /etc/pki_service
          name: maddog-certs
kind: List
