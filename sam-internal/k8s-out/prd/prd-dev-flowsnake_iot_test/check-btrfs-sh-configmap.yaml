apiVersion: v1
data:
  check-btrfs.sh: "#!/bin/bash\nif dmesg | grep \"blocked for more than\"; then\n
    \   # TODO: in the future, just exit non-zero so the SAM auto-rebooter can handle\n
    \   (\n        echo Forcing reboot because btrfs is hung.;\n    ) | mail -s \"Rebooting
    $HOSTNAME (TEST EMAIL, DON'T WORRY)\" flowsnake@salesforce.com \n    echo \"Rebooting
    in 5 seconds\";\n    sleep 5;\n    # TODO: uncomment after testing\n    #echo
    \"b\" > /host-proc/sysrq-trigger;\n    exit 1;\nfi;\n"
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: check-btrfs-sh
  namespace: flowsnake
