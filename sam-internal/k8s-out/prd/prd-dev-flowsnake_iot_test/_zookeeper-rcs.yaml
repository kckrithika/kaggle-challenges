apiVersion: apps/v1beta1
kind: StatefulSet
metadata:
  labels:
    name: zookeeper
  name: zookeeper
  namespace: flowsnake
spec:
  replicas: 3
  serviceName: zookeeper-set
  template:
    metadata:
      labels:
        app: glok-zk
        name: zookeeper
    spec:
      containers:
      - env:
        - name: REPLICAS
          value: "3"
        - name: ZOOKEEPER_HEADLESS_SERVICE
          value: zookeeper-set
        - name: ZOOKEEPER_AUTOPURGE_HOURS
          value: "24"
        image: dva-registry.internal.salesforce.com/dva/flowsnake-zookeeper:345
        imagePullPolicy: Always
        livenessProbe:
          exec:
            command:
            - sh
            - -c
            - '[ $(exec 5<>/dev/tcp/localhost/2181 && echo ruok >&5 && cat <&5) ==
              imok ]'
          initialDelaySeconds: 180
        name: glok-zk
        ports:
        - containerPort: 2181
          name: zk2181
        - containerPort: 2888
          name: zk2888
        - containerPort: 3888
          name: zk3888
        readinessProbe:
          exec:
            command:
            - sh
            - -c
            - '[ $(exec 5<>/dev/tcp/localhost/2181 && echo ruok >&5 && cat <&5) ==
              imok ]'
  updateStrategy:
    type: RollingUpdate
