apiVersion: v1
data:
  electron-opa-istio-container.yaml.template: |-
    containers:
      - name: electron-opa-istio
        image: {{ .Image }}
        args:
          - --plugin-dir=.
          - run
          - --server
          - --config-file=/config/config.yaml
        {{- if .EnvironmentVars}}
        env:
        {{- range $key, $val := .EnvironmentVars}}
        - name: {{$key}}
          {{- if $val.FieldRefFieldPath}}
          valueFrom:
            fieldRef:
              apiVersion: {{$val.FieldRefApiVersion}}
              fieldPath: {{$val.FieldRefFieldPath}}
          {{- else}}
          value: "{{$val.Value}}"
          {{- end}}
        {{- end}}
        {{- end}}
        ports:
        - name: http
          containerPort: 8181
        volumeMounts:
        - mountPath: /config
          name: opa-istio-config
        livenessProbe:
          httpGet:
            scheme: HTTP
            port: 8181
          initialDelaySeconds: 5
          periodSeconds: 5
        readinessProbe:
          httpGet:
            path: /health?bundle=false
            scheme: HTTP
            port: 8181
          initialDelaySeconds: 5
          periodSeconds: 5
        terminationMessagePolicy: FallbackToLogsOnError
    volumes:
      - name: opa-istio-config
        configMap:
          name: electron-opa-injector-configs-opa-istio-config
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app: electron-opa-injector
  name: electron-opa-injector-configs-opa-istio-container
  namespace: authz-injector
